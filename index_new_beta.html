<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תרגול תאוריה מוזיקלית</title>
        <!-- הוספת פונט Heebo גלובלי לשיפור המראה העברי -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* איפוס ועיצוב בסיסי */
        :root {
            --primary-color: #3b82f6; /* כחול */
            --secondary-color: #f59e0b; /* כתום */
            --bg-color: #f9fafb; /* רקע בהיר */
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-radius-lg: 1rem;
            --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.2s ease-in-out;
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            padding: 30px;
            direction: rtl; /* כיוון כתיבה כללי עברי */
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        /* כפתורים ופקדים */
        .controls-group, .note-buttons, .accidental-buttons, .quality-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            background-color: var(--card-bg);
            border: 2px solid #e5e7eb;
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            min-width: 40px;
        }

        button:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        button.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 6px 10px rgba(59, 130, 246, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* כפתורי פעולה עיקריים */
        .action-buttons button {
            flex-grow: 1;
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
            font-size: 1.1rem;
            padding: 12px 20px;
        }

        .action-buttons button:hover {
            background-color: #f97316;
            border-color: #f97316;
        }

        /* כפתורי דיאז/במול */
        .accidental-buttons button {
            min-width: 60px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* תצוגת תוצאות (LTR) */
        .result-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius-lg);
            background-color: #fff;
            direction: ltr; /* יישור התוצאות משמאל לימין */
        }
        
        .result-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            min-width: 80px;
            border: 2px solid var(--primary-color);
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: bold;
            transition: var(--transition);
            background-color: #eff6ff; /* כחול בהיר */
        }
        
        .result-item:hover {
            transform: scale(1.05);
            box-shadow: var(--box-shadow);
        }
        
        .result-item .hebrew-name {
            font-size: 0.9rem;
            font-weight: normal;
            margin-top: 5px;
            color: #4b5563;
        }

        /* תצוגת מהלכי אקורדים */
        .progression-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            cursor: pointer;
            transition: var(--transition);
            min-width: 80px;
        }
        
        .progression-step:hover {
            background-color: #f3f4f6;
            border-radius: 0.75rem;
        }
        
        .roman-numeral {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
            letter-spacing: -1px;
        }
        
        .chord-name {
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-color);
        }

        /* מודל מידע על אקורד */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            max-width: 450px;
            width: 90%;
            direction: rtl;
            animation: fadeIn 0.3s;
        }
        
        .modal-content h3 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .modal-notes-display {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            direction: ltr; /* תווי האקורד משמאל לימין */
            justify-content: center;
        }
        
        .modal-note {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 0.5rem;
            font-weight: bold;
        }
        
        .modal-note .hebrew-name {
            font-size: 0.8rem;
            font-weight: normal;
        }
        
        .modal-description {
            background-color: #f3f4f6;
            padding: 15px;
            border-radius: 0.5rem;
            line-height: 1.6;
            text-align: right;
            margin-bottom: 20px;
        }
        
        .modal-close-button {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* מסך תרגול סולם - מרווחים */
        .scale-intervals-display {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            direction: ltr; /* מרווחים משמאל לימין */
            flex-wrap: wrap;
        }
        
        .interval-item {
            padding: 8px 15px;
            background-color: #fee2e2; /* אדום בהיר */
            color: #dc2626; /* אדום כהה */
            border-radius: 0.5rem;
            font-weight: bold;
            font-size: 0.9rem;
            border: 1px solid #fca5a5;
        }

        /* אנימציות */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === תוספת CSS חדשה: עיצוב מתג (Toggle Switch) === */
        .toggle-switch-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .toggle-switch-label {
            font-weight: 500;
            color: var(--text-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
        /* === סוף תוספת CSS === */

    </style>
</head>
<body>

    <div class="app-container">
        <h1>תרגול הרמוני</h1>
        
        <div id="home-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 20px;">בחר סולם לתרגול</h2>

            <div class="controls-group">
                <div class="note-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">תו שורש</p>
                    <button data-note="C">C (דו)</button>
                    <button data-note="D">D (רה)</button>
                    <button data-note="E">E (מי)</button>
                    <button data-note="F">F (פא)</button>
                    <button data-note="G">G (סול)</button>
                    <button data-note="A">A (לה)</button>
                    <button data-note="B">B (סי)</button>
                </div>
                
                <div class="accidental-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">דיאז / במול</p>
                    <button data-accidental="sharp">♯</button>
                    <button data-accidental="none" class="selected">טבעי</button>
                    <button data-accidental="flat">♭</button>
                </div>
                
                <div class="quality-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">סוג סולם</p>
                    <button data-quality="major" class="selected">מז'ור</button>
                    <button data-quality="minor">מינור</button>
                </div>
            </div>

            <div class="action-buttons controls-group" style="margin-top: 30px;">
                <button onclick="selectRandomScale()">אקראי</button>
                <button id="practice-scale-btn" onclick="startScalePractice()" disabled>תרגול סולם</button>
                <button id="practice-chords-btn" onclick="startChordPractice()" disabled>תרגול מהלכי אקורדים</button>
            </div>
        </div>

        <div id="scale-practice-screen" class="screen" style="display: none;">
            <h2 id="scale-title" style="text-align: center; margin-bottom: 20px; color: var(--secondary-color);"></h2>
            
            <p style="text-align: center; font-weight: 500;">מרווחים בין תו לתו (LTR):</p>
            <div id="scale-intervals-container" class="scale-intervals-display">
                </div>

            <div class="controls-group" style="margin-top: 30px; justify-content: center;">
                <button id="show-notes-btn" onclick="showScaleNotes()">הצג את התווים</button>
            </div>

            <p style="text-align: center; font-weight: 500; margin-top: 20px; display: none;" id="notes-label">תווי הסולם (LTR):</p>
            <div id="scale-notes-container" class="result-display">
                </div>

            <div class="controls-group" style="margin-top: 40px;">
                <button onclick="switchScreen('home-screen')">חזור לבית</button>
            </div>
        </div>

        <div id="progression-practice-screen" class="screen" style="display: none;">
            <h2 id="progression-title" style="text-align: center; margin-bottom: 30px; color: var(--secondary-color);"></h2>

            <div class="toggle-switch-container">
                <label for="toggle-chord-names" class="toggle-switch-label">הסתר שמות אקורדים</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-chord-names" onchange="displayCurrentProgression()">
                    <span class="slider round"></span>
                </label>
            </div>
            <div id="current-progression-container" class="result-display" style="justify-content: space-around; min-height: 120px; flex-wrap: nowrap; overflow-x: auto;">
                </div>
            
            <p id="progression-description" style="text-align: center; margin-top: 15px; font-style: italic; color: #4b5563;"></p>

            <div class="controls-group" style="margin-top: 40px;">
                <button onclick="changeProgression(-1)">קודם</button>
                <button onclick="changeProgression(1)">הבא</button>
            </div>
            
            <div class="controls-group">
                <button onclick="switchScreen('home-screen')">חזור לדף הבית</button>
            </div>
        </div>
        
    </div>
    
    <div id="chord-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-chord-title"></h3>
            
            <p style="font-weight: bold; text-align: right; margin-bottom: 10px;">תווים מרכיבים (LTR):</p>
            <div id="modal-notes-display" class="modal-notes-display">
                </div>
            
            <p style="font-weight: bold; text-align: right; margin-bottom: 10px;">הסבר הרמוני:</p>
            <div id="modal-description" class="modal-description">
                </div>
            
            <button id="modal-close-button" class="modal-close-button" onclick="closeChordModal()">הבנתי</button>
        </div>
    </div>

<script>
    // =========================================================================================
    // 1. הטמעת קבצי ה-JS: Notes, Chords, Scales
    // =========================================================================================

    // --- notes_data.js ---
    // הגדרות הקלידים (צלילים) באוקטבה אחת
    const note_C1 = { name_en_primary: 'C', name_en_alternate: 'C', name_he_primary: 'דו', name_he_alternate: 'דו', half_tone_distance: 0 };
    const note_CSharp1 = { name_en_primary: 'C♯', name_en_alternate: 'D♭', name_he_primary: 'דו דיאז', name_he_alternate: 'רה במול', half_tone_distance: 1 };
    const note_D1 = { name_en_primary: 'D', name_en_alternate: 'D', name_he_primary: 'רה', name_he_alternate: 'רה', half_tone_distance: 2 };
    const note_DSharp1 = { name_en_primary: 'D♯', name_en_alternate: 'E♭', name_he_primary: 'רה דיאז', name_he_alternate: 'מי במול', half_tone_distance: 3 };
    const note_E1 = { name_en_primary: 'E', name_en_alternate: 'E', name_he_primary: 'מי', name_he_alternate: 'מי', half_tone_distance: 4 };
    const note_F1 = { name_en_primary: 'F', name_en_alternate: 'F', name_he_primary: 'פא', name_he_alternate: 'פא', half_tone_distance: 5 };
    const note_FSharp1 = { name_en_primary: 'F♯', name_en_alternate: 'G♭', name_he_primary: 'פא דיאז', name_he_alternate: 'סול במול', half_tone_distance: 6 };
    const note_G1 = { name_en_primary: 'G', name_en_alternate: 'G', name_he_primary: 'סול', name_he_alternate: 'סול', half_tone_distance: 7 };
    const note_GSharp1 = { name_en_primary: 'G♯', name_en_alternate: 'A♭', name_he_primary: 'סול דיאז', name_he_alternate: 'לה במול', half_tone_distance: 8 };
    const note_A1 = { name_en_primary: 'A', name_en_alternate: 'A', name_he_primary: 'לה', name_he_alternate: 'לה', half_tone_distance: 9 };
    const note_ASharp1 = { name_en_primary: 'A♯', name_en_alternate: 'B♭', name_he_primary: 'לה דיאז', name_he_alternate: 'סי במול', half_tone_distance: 10 };
    const note_B1 = { name_en_primary: 'B', name_en_alternate: 'B', name_he_primary: 'סי', name_he_alternate: 'סי', half_tone_distance: 11 };
    
    const ALL_NOTES_ARRAY = [
        note_C1, note_CSharp1, note_D1, note_DSharp1, note_E1, note_F1,
        note_FSharp1, note_G1, note_GSharp1, note_A1, note_ASharp1, note_B1
    ].sort((a, b) => a.half_tone_distance - b.half_tone_distance);
    const BASE_NOTE_DISTANCES = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 };

    // --- chords_data.js ---
    // הגדרות של 10 סוגי אקורדים נפוצים
    const chord_Major = { name_he: 'מז׳ור', name_en: 'Major', symbol_suffix: '', description_he: 'האקורד הבסיסי, מורכב מפרימה, טרצה גדולה (4 חצאי טונים) וקווינטה זכה (7 חצאי טונים).', intervals: [0, 4, 7] };
    const chord_Minor = { name_he: 'מינור', name_en: 'Minor', symbol_suffix: 'm', description_he: 'אקורד בעל אופי נוגה, מורכב מפרימה, טרצה קטנה (3 חצאי טונים) וקווינטה זכה.', intervals: [0, 3, 7] };
    const chord_Dominant7 = { name_he: 'דומיננט 7', name_en: 'Dominant 7th', symbol_suffix: '7', description_he: 'אקורד עם מתח חזק (טריטון), רוצה להיפתר לטוניקה. מורכב מטרצה גדולה, קווינטה זכה ושביעית קטנה (10 חצאי טונים).', intervals: [0, 4, 7, 10] };
    const chord_Major7 = { name_he: 'מז׳ור 7', name_en: 'Major 7th', symbol_suffix: 'maj7', description_he: 'אקורד יציב ורך, עם שביעית גדולה (11 חצאי טונים).', intervals: [0, 4, 7, 11] };
    const chord_Minor7 = { name_he: 'מינור 7', name_en: 'Minor 7th', symbol_suffix: 'm7', description_he: 'אקורד רגוע ונינוח, משמש רבות בג׳אז ובפיוז׳ן, עם טרצה קטנה ושביעית קטנה.', intervals: [0, 3, 7, 10] };
    const chord_HalfDiminished = { name_he: 'מינור 7b5', name_en: 'Minor 7th flat 5 (Half-Diminished)', symbol_suffix: 'm7b5', description_he: 'אקורד מורכב עם מתח חזק, משמש בעיקר במוזיקת ג׳אז, עם קווינטה מוקטנת (6 חצאי טונים).', intervals: [0, 3, 6, 10] };
    const chord_Augmented = { name_he: 'מוגדל', name_en: 'Augmented', symbol_suffix: 'aug', description_he: 'אקורד עם תחושה חלומית או מתוחה, עם קווינטה מוגדלת (8 חצאי טונים).', intervals: [0, 4, 8] };
    const chord_Diminished = { name_he: 'מוקטן', name_en: 'Diminished', symbol_suffix: 'dim', description_he: 'אקורד לא יציב ודרמטי, עם טרצה קטנה וקווינטה מוקטנת.', intervals: [0, 3, 6] };
    const chord_Sus4 = { name_he: 'סאס 4', name_en: 'Suspended 4th', symbol_suffix: 'sus4', description_he: 'אקורד ללא טרצה, במקומה יש קוורטה (5 חצאי טונים), יוצר תחושת המתנה.', intervals: [0, 5, 7] };
    const chord_Sus2 = { name_he: 'סאס 2', name_en: 'Suspended 2nd', symbol_suffix: 'sus2', description_he: 'אקורד ללא טרצה, במקומה יש סקונדה גדולה (2 חצאי טונים), יוצר תחושת פתיחות.', intervals: [0, 2, 7] };
    const ALL_CHORDS_MAP = { 'Major': chord_Major, 'Minor': chord_Minor, 'Dominant7': chord_Dominant7, 'Major7': chord_Major7, 'Minor7': chord_Minor7, 'HalfDiminished': chord_HalfDiminished, 'Augmented': chord_Augmented, 'Diminished': chord_Diminished, 'Sus4': chord_Sus4, 'Sus2': chord_Sus2 };

    // --- scales_data.js ---
    // הגדרות סולמות בסיסיים (מז'ור ומינור)
    const scale_Major = {
        name_he: 'מז׳ור',
        name_en: 'Major',
        description_he: 'סולם משמח ובהיר, אבן הבניין הבסיסית של המוזיקה המערבית.',
        intervals: [0, 2, 4, 5, 7, 9, 11],
        step_intervals_he: ['טון', 'טון', 'חצי טון', 'טון', 'טון', 'טון', 'חצי טון']
    };

    const scale_Minor = {
        name_he: 'מינור טבעי',
        name_en: 'Natural Minor',
        description_he: 'סולם בעל אופי נוגה ומלנכולי, יחסי לסולם המז׳ור (היחסי).',
        intervals: [0, 2, 3, 5, 7, 8, 10],
        step_intervals_he: ['טון', 'חצי טון', 'טון', 'טון', 'חצי טון', 'טון', 'טון']
    };

    // =========================================================================================
    // 2. הטמעת קבצי ה-JS: מהלכי אקורדים (Progressions) - מלאים
    // =========================================================================================

    // --- chord_progressions_maj.js (מלא) ---
    // מרווחי השורשים (Roots) הדיאטוניים בסולם מז'ור: I=0, ii=2, iii=4, IV=5, V=7, vi=9, vii°=11
    const ALL_PROGRESSIONS_MAJOR = [
        // === קבוצה 1: קל (הכי נפוץ, משולשים בלבד) ===
        {
            sequence_number: 1,
            symbol_roman: ['I', 'IV', 'V', 'I'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך הפופ והרוק הבסיסי ביותר, בעל תחושת סיום חזקה (קדנצה מושלמת).'
        },
        {
            sequence_number: 2,
            symbol_roman: ['I', 'vi', 'IV', 'V'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך "הקדנצה הפכפכה", נפוץ מאוד בשירי פופ, יוצר תחושה של המשכיות.'
        },
        {
            sequence_number: 3,
            symbol_roman: ['ii', 'V', 'I'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major],
            description_he: 'קדנצה בסיסית בג׳אז ובמוזיקה קלאסית, מתחזקת את הטוניקה.'
        },
        {
            sequence_number: 4,
            symbol_roman: ['I', 'V', 'vi', 'IV'],
            roots_intervals: [0, 7, 9, 5],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Major],
            description_he: 'מהלך הפופ המפורסם ("4 אקורדים"), נשמע טוב בכל סגנון.'
        },
        {
            sequence_number: 5,
            symbol_roman: ['I', 'iii', 'vi', 'IV'],
            roots_intervals: [0, 4, 9, 5],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: 'מהלך רגוע ומלודי, עובר דרך הדרגה השלישית המינורית.'
        },
        {
            sequence_number: 6,
            symbol_roman: ['vi', 'IV', 'I', 'V'],
            roots_intervals: [9, 5, 0, 7],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'וריאציה של מהלך הפופ המתחילה בדרגה המינורית השישית.'
        },
        {
            sequence_number: 7,
            symbol_roman: ['I', 'IV', 'I', 'V'],
            roots_intervals: [0, 5, 0, 7],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך פשוט ובטוח, מתאים לשירים קלילים ועממיים.'
        },
        {
            sequence_number: 8,
            symbol_roman: ['iii', 'vi', 'ii', 'V'],
            roots_intervals: [4, 9, 2, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Major],
            description_he: 'רצף יורד של אקורדים המכין את הקרקע לקדנצה V-I.'
        },
        {
            sequence_number: 9,
            symbol_roman: ['I', 'IV', 'V', 'vi'],
            roots_intervals: [0, 5, 7, 9],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Minor],
            description_he: 'מהלך נדיר יחסית המשתמש ב-vi כנקודת תנועה לאחור.'
        },
        {
            sequence_number: 10,
            symbol_roman: ['ii', 'I', 'V', 'IV'],
            roots_intervals: [2, 0, 7, 5],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך אקורדים המשתמש בדרגה ii כדי להגיע חזרה לטוניקה.'
        },
        // === קבוצה 2: בינוני (שביעיות וסאספנדים) ===
        {
            sequence_number: 11,
            symbol_roman: ['I', 'V7', 'I', 'IV'],
            roots_intervals: [0, 7, 0, 5],
            chord_types: [chord_Major, chord_Dominant7, chord_Major, chord_Major],
            description_he: 'שימוש ב-V7 (דומיננט 7) להדגשת הקדנצה ל-I.'
        },
        {
            sequence_number: 12,
            symbol_roman: ['ii7', 'V7', 'Imaj7'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: 'הקדנצה הג׳אזית הקלאסית (ii-V-I) עם שביעיות.'
        },
        {
            sequence_number: 13,
            symbol_roman: ['Imaj7', 'IVmaj7', 'ii7', 'V7'],
            roots_intervals: [0, 5, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: 'מהלך הרמוני חלק, נפוץ במוזיקת לאונג׳ ובוסה נובה.'
        },
        {
            sequence_number: 14,
            symbol_roman: ['I', 'V(sus4)', 'V', 'I'],
            roots_intervals: [0, 7, 7, 0],
            chord_types: [chord_Major, chord_Sus4, chord_Major, chord_Major],
            description_he: 'שימוש באקורד מושעה (sus4) כדי ליצור מתח קל לפני הפתרון.'
        },
        {
            sequence_number: 15,
            symbol_roman: ['iii7', 'vi7', 'ii7', 'V7'],
            roots_intervals: [4, 9, 2, 7],
            chord_types: [chord_Minor7, chord_Minor7, chord_Minor7, chord_Dominant7],
            description_he: 'רצף שביעיות יורד שמוביל באופן טבעי לקדנצה V7.'
        },
        {
            sequence_number: 16,
            symbol_roman: ['IV', 'V', 'vi', 'iii'],
            roots_intervals: [5, 7, 9, 4],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Minor],
            description_he: 'מהלך מתוח יותר היוצר תחושת תנועה רציפה.'
        },
        {
            sequence_number: 17,
            symbol_roman: ['Imaj7', 'iii7', 'IVmaj7', 'vi7'],
            roots_intervals: [0, 4, 5, 9],
            chord_types: [chord_Major7, chord_Minor7, chord_Major7, chord_Minor7],
            description_he: 'מהלך רך ויציב הנע בין שביעיות מז׳ור ומינור.'
        },
        {
            sequence_number: 18,
            symbol_roman: ['vi', 'V', 'IV', 'I'],
            roots_intervals: [9, 7, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך יורד (descending) פופולרי ברוק, מתחיל בדרגה המינורית.'
        },
        {
            sequence_number: 19,
            symbol_roman: ['I(sus2)', 'I', 'IV', 'V'],
            roots_intervals: [0, 0, 5, 7],
            chord_types: [chord_Sus2, chord_Major, chord_Major, chord_Major],
            description_he: 'שימוש ב-sus2 כקישוט לטוניקה לפני מעבר ל-IV.'
        },
        {
            sequence_number: 20,
            symbol_roman: ['IVmaj7', 'Imaj7', 'ii7', 'V7'],
            roots_intervals: [5, 0, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: 'מהלך מתחלף (plagal) שמכין ל-ii-V-I ג׳אזי.'
        },
        // === קבוצה 3: מתקדם (דימינישד, מוגדל, ודרגות מושאלות) ===
        {
            sequence_number: 21,
            symbol_roman: ['I', 'bIII', 'IV', 'V'],
            roots_intervals: [0, 3, 5, 7],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: 'שימוש ב-bIII (דרגה מושאלת מהסולם המינורי) ליצירת צבע כרומטי.'
        },
        {
            sequence_number: 22,
            symbol_roman: ['I', 'IV', 'bVII', 'IV'],
            roots_intervals: [0, 5, 10, 5],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך רוק/בלוז פופולרי המשתמש ב-bVII (דומיננט משני).'
        },
        {
            sequence_number: 23,
            symbol_roman: ['I', 'vi', 'ii', 'V7'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Dominant7],
            description_he: 'מהלך יסודי, מכין את ה-ii-V לפתרון הדומיננטי.'
        },
        {
            sequence_number: 24,
            symbol_roman: ['Imaj7', 'vi7', 'ii7', 'V7'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major7, chord_Minor7, chord_Minor7, chord_Dominant7],
            description_he: 'קדנצה ג׳אזית מלאה I-vi-ii-V, הבסיס לסטנדרטים רבים.'
        },
        {
            sequence_number: 25,
            symbol_roman: ['I', 'IV', 'vii°', 'iii'],
            roots_intervals: [0, 5, 11, 4],
            chord_types: [chord_Major, chord_Major, chord_Diminished, chord_Minor],
            description_he: 'שימוש ב-vii° (הדרגה המוקטנת) כגשר כרומטי מתוח.'
        },
        {
            sequence_number: 26,
            symbol_roman: ['V7/IV', 'IV', 'V7', 'I'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Dominant7, chord_Major, chord_Dominant7, chord_Major],
            description_he: 'שימוש בדומיננט המשני (V7 של IV) ליצירת מתח לפני ה-IV.'
        },
        {
            sequence_number: 27,
            symbol_roman: ['I', 'V/vi', 'vi', 'IV'],
            roots_intervals: [0, 4, 9, 5],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Major],
            description_he: 'שימוש בדומיננט משני (V של vi) ליצירת מתח חזק לפני הדרגה השישית.'
        },
        {
            sequence_number: 28,
            symbol_roman: ['I', 'Iaug', 'IV', 'iv'],
            roots_intervals: [0, 0, 5, 5],
            chord_types: [chord_Major, chord_Augmented, chord_Major, chord_Minor],
            description_he: 'מעבר כרומטי פנימי באמצעות אקורד I מוגדל ל-IV, ומשם ל-iv המינורי.'
        },
        {
            sequence_number: 29,
            symbol_roman: ['IV', 'vii°', 'iii', 'vi'],
            roots_intervals: [5, 11, 4, 9],
            chord_types: [chord_Major, chord_Diminished, chord_Minor, chord_Minor],
            description_he: 'מהלך המשתמש באקורדים לא פופולריים ליצירת צבע מיוחד.'
        },
        {
            sequence_number: 30,
            symbol_roman: ['Imaj7', 'bIImaj7', 'Imaj7'],
            roots_intervals: [0, 1, 0],
            chord_types: [chord_Major7, chord_Major7, chord_Major7],
            description_he: 'מהלך כרומטי שקט (Truck Driver Modulation), נפוץ בג׳אז ובאר׳אנבי.'
        },
        // === קבוצה 4: ג'אז ופיוז'ן (שביעיות מתקדמות) ===
        {
            sequence_number: 31,
            symbol_roman: ['ii7', 'V7', 'Imaj7', 'IVmaj7'],
            roots_intervals: [2, 7, 0, 5],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7, chord_Major7],
            description_he: 'קדנצה ג׳אזית שמובילה לאקורד IVmaj7 להמשכיות המהלך.'
        },
        {
            sequence_number: 32,
            symbol_roman: ['iii7', 'bIII7', 'ii7', 'V7'],
            roots_intervals: [4, 3, 2, 7],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Minor7, chord_Dominant7],
            description_he: 'שימוש בדומיננט משני (bIII7) ככרומטיזם ליצירת מתח יורד.'
        },
        {
            sequence_number: 33,
            symbol_roman: ['I', 'vi', 'ii', 'V'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: 'קאנון פופ/רוק פשוט.'
        },
        {
            sequence_number: 34,
            symbol_roman: ['Imaj7', 'bVImaj7', 'ii7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: 'שימוש ב-bVI (דרגה מושאלת) כדי להוסיף גוון מפתיע לפני ה-ii-V.'
        },
        {
            sequence_number: 35,
            symbol_roman: ['vi7', 'ii7', 'V7', 'Imaj7'],
            roots_intervals: [9, 2, 7, 0],
            chord_types: [chord_Minor7, chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: 'מהלך יסודי שמתחיל בדרגה השישית ומוביל לטוניקה (מעגל הקווינטות).'
        },
        {
            sequence_number: 36,
            symbol_roman: ['Imaj7', 'bVII7', 'IVmaj7'],
            roots_intervals: [0, 10, 5],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7],
            description_he: 'מעבר לידי (backdoor) ליצירת תנועה מהירה ל-IVmaj7.'
        },
        {
            sequence_number: 37,
            symbol_roman: ['ii7', 'V7(alt)', 'Imaj7'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: 'קדנצה ii-V-I עם V7 מוחלף (Alternate) להוספת מתח חריף.'
        },
        {
            sequence_number: 38,
            symbol_roman: ['I', 'iii', 'V', 'IV'],
            roots_intervals: [0, 4, 7, 5],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך המדלג על ה-vi ומשתמש ב-iii ליצירת גוון שונה.'
        },
        {
            sequence_number: 39,
            symbol_roman: ['Imaj7', 'bIIImaj7', 'IVmaj7', 'bVmaj7'],
            roots_intervals: [0, 3, 5, 6],
            chord_types: [chord_Major7, chord_Major7, chord_Major7, chord_Major7],
            description_he: 'מהלך משתנה באמצעות אקורדי מז׳ור-7 כרומטיים, נשמע מודרני.'
        },
        {
            sequence_number: 40,
            symbol_roman: ['I', 'V/V', 'V', 'I'],
            roots_intervals: [0, 2, 7, 0],
            chord_types: [chord_Major, chord_Dominant7, chord_Major, chord_Major],
            description_he: 'שימוש בדומיננט הדומיננטי (V של V) כדי להדגיש את V לפני הטוניקה.'
        },
        // === קבוצה 5: מודרני וניסיוני ===
        {
            sequence_number: 41,
            symbol_roman: ['IV', 'I', 'V/vi', 'vi'],
            roots_intervals: [5, 0, 4, 9],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Minor],
            description_he: 'מהלך יורד (Descending) המשתמש ב-V/vi כדומיננט משני.'
        },
        {
            sequence_number: 42,
            symbol_roman: ['Imaj7', 'V/vi', 'IVmaj7', 'V7/ii'],
            roots_intervals: [0, 4, 5, 9],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7, chord_Dominant7],
            description_he: 'רצף דומיננטים משניים היוצר מתח מתמשך.'
        },
        {
            sequence_number: 43,
            symbol_roman: ['I', 'vi', 'IV', 'V'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך קלאסי, אך נשמע נכון גם במוזיקה עדכנית.'
        },
        {
            sequence_number: 44,
            symbol_roman: ['I', 'V(sus4)', 'vi', 'V(sus4)'],
            roots_intervals: [0, 7, 9, 7],
            chord_types: [chord_Major, chord_Sus4, chord_Minor, chord_Sus4],
            description_he: 'שימוש חוזר ב-sus4 ליצירת תחושה צפה ונוקשה פחות.'
        },
        {
            sequence_number: 45,
            symbol_roman: ['I', 'bVI', 'bVII', 'I'],
            roots_intervals: [0, 8, 10, 0],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך רוק כבד המשתמש בדרגות מושאלות (bVI, bVII) ליצירת צליל גדול.'
        },
        {
            sequence_number: 46,
            symbol_roman: ['IV', 'iii', 'vi', 'ii'],
            roots_intervals: [5, 4, 9, 2],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Minor],
            description_he: 'מהלך שקט ונינוח, מתקדם בשלישיות יורדות.'
        },
        {
            sequence_number: 47,
            symbol_roman: ['IV^7', 'V7', 'I^7', 'vi7'],
            roots_intervals: [5, 7, 0, 9],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7, chord_Minor7],
            description_he: 'קדנצה IV-V-I ג׳אזית עם שימוש בדרגת vi7 ליצירת לולאה רציפה.'
        },
        {
            sequence_number: 48,
            symbol_roman: ['I', 'ii7', 'iii7', 'IV^7'],
            roots_intervals: [0, 2, 4, 5],
            chord_types: [chord_Major, chord_Minor7, chord_Minor7, chord_Major7],
            description_he: 'מהלך עולה שלם בדרגות רצופות, משביעית מינור לשביעית מז׳ור.'
        },
        {
            sequence_number: 49,
            symbol_roman: ['vi', 'vii°', 'I', 'IV'],
            roots_intervals: [9, 11, 0, 5],
            chord_types: [chord_Minor, chord_Diminished, chord_Major, chord_Major],
            description_he: 'מעבר מתוח מ-vi באמצעות הדימינישד (vii°) ליצירת פתרון חזק לטוניקה.'
        },
        {
            sequence_number: 50,
            symbol_roman: ['ii7', 'I/iii', 'IV^7', 'V7'],
            roots_intervals: [2, 4, 5, 7],
            chord_types: [chord_Minor7, chord_Major, chord_Major7, chord_Dominant7],
            description_he: 'מהלך מורכב הכולל אקורד חילוף (Slash Chord) ליצירת תנועת באס רציפה.'
        },
    ];

    // --- chord_progressions_min.js (מלא) ---
    // מרווחי השורשים (Roots) הדיאטוניים בסולם מינור טבעי: i=0, ii°=2, III=3, iv=5, v=7, VI=8, VII=10
    // דרגות מושאלות (Harmonic Minor): V=7 (Major), vii°=11 (Diminished)
    const ALL_PROGRESSIONS_MINOR = [
        // === קבוצה 1: קל (הכי נפוץ, משולשים בלבד) ===
        {
            sequence_number: 1,
            symbol_roman: ['i', 'iv', 'v', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Minor],
            description_he: 'מהלך המינור הטבעי הבסיסי ביותר, בעל תחושה נוגה ומלנכולית.'
        },
        {
            sequence_number: 2,
            symbol_roman: ['i', 'VI', 'VII', 'i'],
            roots_intervals: [0, 8, 10, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Minor],
            description_he: 'מהלך נפוץ ברוק ובמוזיקה עממית, יוצר תנועה חלקה כלפי מעלה ואחורה.'
        },
        {
            sequence_number: 3,
            symbol_roman: ['i', 'iv', 'VII', 'III'],
            roots_intervals: [0, 5, 10, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך שקט ומלודי, עובר בין דרגות מינוריות למז׳וריות.'
        },
        {
            sequence_number: 4,
            symbol_roman: ['i', 'v', 'VI', 'III'],
            roots_intervals: [0, 7, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך רגוע, משתמש ב-v וב-VI כדי להגיע לטוניקה היחסית (III).'
        },
        {
            sequence_number: 5,
            symbol_roman: ['i', 'VI', 'III', 'VII'],
            roots_intervals: [0, 8, 3, 10],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך המשתמש בדרגה III כטוניקה יחסית.'
        },
        {
            sequence_number: 6,
            symbol_roman: ['i', 'iv', 'VI', 'III'],
            roots_intervals: [0, 5, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'רצף חלק המוביל מדרגה iv לדרגה היחסית III.'
        },
        {
            sequence_number: 7,
            symbol_roman: ['i', 'VII', 'VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך פופולרי במוזיקת מטאל/רוק המשתמש בדרגות VII-VI-V.'
        },
        {
            sequence_number: 8,
            symbol_roman: ['iv', 'VII', 'III', 'VI'],
            roots_intervals: [5, 10, 3, 8],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך מחזורי (loop) של דרגות מז׳וריות בתוך סולם מינורי.'
        },
        {
            sequence_number: 9,
            symbol_roman: ['i', 'III', 'VII', 'IV'],
            roots_intervals: [0, 3, 10, 5],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך אקורדים המדגיש את הדרגה IV המז׳ורית.'
        },
        {
            sequence_number: 10,
            symbol_roman: ['ii°', 'V', 'i'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Diminished, chord_Major, chord_Minor],
            description_he: 'קדנצה מינורית חזקה (ii° - V - i) באמצעות הדומיננט המז׳ורי (מהרמוני מינור).'
        },
        // === קבוצה 2: בינוני (שביעיות ודומיננטים משניים) ===
        {
            sequence_number: 11,
            symbol_roman: ['i', 'V7', 'i'],
            roots_intervals: [0, 7, 0],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor],
            description_he: 'קדנצה מינורית מושלמת וחזקה באמצעות V7.'
        },
        {
            sequence_number: 12,
            symbol_roman: ['i', 'VImaj7', 'iiø7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Minor, chord_Major7, chord_HalfDiminished, chord_Dominant7],
            description_he: 'קדנצה ii-V-i ג׳אזית במינור, מודרנית וצבעונית.'
        },
        {
            sequence_number: 13,
            symbol_roman: ['i', 'iv', 'v7', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Minor7, chord_Minor],
            description_he: 'מהלך המשתמש בדרגה v7 (מינור 7) ליצירת תנועה רכה יותר.'
        },
        {
            sequence_number: 14,
            symbol_roman: ['III^7', 'VI^7', 'iiø7', 'V7'],
            roots_intervals: [3, 8, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_HalfDiminished, chord_Dominant7],
            description_he: 'מעגל קווינטות חלקי המתחיל בטוניקה היחסית, נפוץ בבוסה נובה.'
        },
        {
            sequence_number: 15,
            symbol_roman: ['i', 'IV7/i', 'iv', 'V7'],
            roots_intervals: [0, 5, 5, 7],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: 'שימוש ב-IV7 כדומיננט משני המושאל (IV7) ליצירת צבע בלוזי.'
        },
        {
            sequence_number: 16,
            symbol_roman: ['iiø7', 'V7', 'i'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Minor],
            description_he: 'קדנצת iiø7-V7-i, גרסת המינור הקלאסית ל-ii-V-I.'
        },
        {
            sequence_number: 17,
            symbol_roman: ['i', 'IV/i', 'iv', 'i'],
            roots_intervals: [0, 5, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Minor, chord_Minor],
            description_he: 'מעבר פלאגלי (iv-i) שמנוקד באקורד IV מז׳ור מושאל (IV/i).'
        },
        {
            sequence_number: 18,
            symbol_roman: ['i', 'i/VII', 'i/VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Major],
            description_he: 'מהלך יורד (Descending) עם חילופי בס, דרמטי מאוד.'
        },
        {
            sequence_number: 19,
            symbol_roman: ['i', 'v', 'VI', 'V'],
            roots_intervals: [0, 7, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך היוצר מתח על הדרגה V המז׳ורית לפני חזרה ל-i.'
        },
        {
            sequence_number: 20,
            symbol_roman: ['VII', 'i', 'iv', 'VII'],
            roots_intervals: [10, 0, 5, 10],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: 'מהלך רוק רפטטיבי המתחיל בדרגה השביעית.'
        },
        // === קבוצה 3: מתקדם (הרמוני, מלודי, דימינישד) ===
        {
            sequence_number: 21,
            symbol_roman: ['i', 'v(aug)', 'VI', 'IV'],
            roots_intervals: [0, 7, 8, 5],
            chord_types: [chord_Minor, chord_Augmented, chord_Major, chord_Major],
            description_he: 'שימוש ב-v מוגדל (מהרמוני מינור) ליצירת צליל מזרחי.'
        },
        {
            sequence_number: 22,
            symbol_roman: ['i', 'iv', 'V7', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Dominant7, chord_Minor],
            description_he: 'קדנצה מלאה במינור הרמוני (i-iv-V7-i).'
        },
        {
            sequence_number: 23,
            symbol_roman: ['iiø7', 'V7/III', 'III^7'],
            roots_intervals: [2, 10, 3],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Major7],
            description_he: 'קדנצה ii-V-I שמובילה לטוניקה היחסית (III) באמצעות דומיננט משני.'
        },
        {
            sequence_number: 24,
            symbol_roman: ['i', 'vii°7', 'i'],
            roots_intervals: [0, 11, 0],
            chord_types: [chord_Minor, chord_Diminished, chord_Minor],
            description_he: 'שימוש ב-vii°7 (דימינישד) בתוך סולם מינורי, יוצר מתח דרמטי חזק.'
        },
        {
            sequence_number: 25,
            symbol_roman: ['i', 'VI', 'III', 'iiø7'],
            roots_intervals: [0, 8, 3, 2],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_HalfDiminished],
            description_he: 'מהלך יציב המכין ל-iiø7 מתוח לפני חזרה אפשרית ל-V7.'
        },
        {
            sequence_number: 26,
            symbol_roman: ['i', 'V7/iv', 'iv', 'V7'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: 'שימוש בדומיננט משני (V7 של iv) ליצירת תנועה חזקה לדרגה iv.'
        },
        {
            sequence_number: 27,
            symbol_roman: ['i', 'iv', 'V7', 'VI'],
            roots_intervals: [0, 5, 7, 8],
            chord_types: [chord_Minor, chord_Minor, chord_Dominant7, chord_Major],
            description_he: 'קדנצה הטעיה (Deceptive Cadence) ל-VI במקום ל-i.'
        },
        {
            sequence_number: 28,
            symbol_roman: ['iv', 'i/III', 'VI', 'V'],
            roots_intervals: [5, 3, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'חילוף בס מתוח ל-III מז׳ור לפני מעבר ל-VI.'
        },
        {
            sequence_number: 29,
            symbol_roman: ['iiø7', 'III^7', 'V7', 'i'],
            roots_intervals: [2, 3, 7, 0],
            chord_types: [chord_HalfDiminished, chord_Major7, chord_Dominant7, chord_Minor],
            description_he: 'רצף מודרני המשתמש ב-III^7 כדי לעבור בצורה חלקה לקדנצה V7.'
        },
        {
            sequence_number: 30,
            symbol_roman: ['i', 'iv', 'i/V', 'V7'],
            roots_intervals: [0, 5, 7, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Dominant7],
            description_he: 'הקדנצה i-iv עם בס V שמחזקת את ה-V7 הדומיננטי.'
        },
        // === קבוצה 4: מודרני (פופ/R&B מינורי) ===
        {
            sequence_number: 31,
            symbol_roman: ['i', 'bVII', 'bVI', 'i'],
            roots_intervals: [0, 10, 8, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Minor],
            description_he: 'מהלך אופייני ל-R&B ופופ מודרני, עם דרגות מושאלות (bVII, bVI).'
        },
        {
            sequence_number: 32,
            symbol_roman: ['iv', 'bVII', 'III', 'VI'],
            roots_intervals: [5, 10, 3, 8],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: 'מהלך מחזורי של אקורדים מז׳וריים ומינוריים המתקדם ברביעיות/קווינטות.'
        },
        {
            sequence_number: 33,
            symbol_roman: ['i', 'v', 'VI', 'VII'],
            roots_intervals: [0, 7, 8, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך שיכול להתאים למוזיקה קלאסית או פולק.'
        },
        {
            sequence_number: 34,
            symbol_roman: ['i', 'III^7', 'VI^7', 'iiø7'],
            roots_intervals: [0, 3, 8, 2],
            chord_types: [chord_Minor, chord_Major7, chord_Major7, chord_HalfDiminished],
            description_he: 'רצף שביעיות ג׳אזי במינור.'
        },
        {
            sequence_number: 35,
            symbol_roman: ['i', 'VII', 'iv', 'i'],
            roots_intervals: [0, 10, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Minor, chord_Minor],
            description_he: 'מהלך בסיסי וקל עם תנועה פשוטה.'
        },
        {
            sequence_number: 36,
            symbol_roman: ['v', 'i', 'III', 'VII'],
            roots_intervals: [7, 0, 3, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך שמתחיל בדרגה v ויוצר תחושת תנועה חזקה לטוניקה.'
        },
        {
            sequence_number: 37,
            symbol_roman: ['i', 'i/VII', 'VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'שימוש בבס יורד כרומטי (i, i/VII, VI) ליצירת תנועה דרמטית.'
        },
        {
            sequence_number: 38,
            symbol_roman: ['III^7', 'VII7', 'i7'],
            roots_intervals: [3, 10, 0],
            chord_types: [chord_Major7, chord_Dominant7, chord_Minor7],
            description_he: 'קדנצה ג׳אזית עם אקורד מוחלף VII7 שמוביל לטוניקה מינורית.'
        },
        {
            sequence_number: 39,
            symbol_roman: ['i', 'iiø7', 'III^7', 'iv7'],
            roots_intervals: [0, 2, 3, 5],
            chord_types: [chord_Minor, chord_HalfDiminished, chord_Major7, chord_Minor7],
            description_he: 'מהלך עולה שמוביל מ-i ל-iv7 באמצעות אקורדים מתוחים.'
        },
        {
            sequence_number: 40,
            symbol_roman: ['i', 'v', 'VI', 'III'],
            roots_intervals: [0, 7, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך רך המשתמש ב-III כטוניקה יחסית זמנית.'
        },
        // === קבוצה 5: ג'אז ופיוז'ן מינורי ===
        {
            sequence_number: 41,
            symbol_roman: ['i7', 'iv7', 'VII7', 'III^7'],
            roots_intervals: [0, 5, 10, 3],
            chord_types: [chord_Minor7, chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: 'רצף שביעיות מחזורי, נפוץ בסגנונות לטיניים וג׳אז מינורי.'
        },
        {
            sequence_number: 42,
            symbol_roman: ['iiø7', 'V7', 'i', 'V7/III'],
            roots_intervals: [2, 7, 0, 10],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: 'שימוש בדומיננט משני (V7 של III) כהכנה לטוניקה היחסית.'
        },
        {
            sequence_number: 43,
            symbol_roman: ['i', 'VI', 'II7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Minor, chord_Major, chord_Dominant7, chord_Dominant7],
            description_he: 'שימוש ב-II7 (דומיננט משני של V) ליצירת מתח חזק לפני ה-V7.'
        },
        {
            sequence_number: 44,
            symbol_roman: ['i', 'i(aug)', 'iv', 'VII'],
            roots_intervals: [0, 0, 5, 10],
            chord_types: [chord_Minor, chord_Augmented, chord_Minor, chord_Major],
            description_he: 'מעבר כרומטי על הטוניקה (i ל-iAug) כדי ליצור תנועה חדה ל-iv.'
        },
        {
            sequence_number: 45,
            symbol_roman: ['III^7', 'i7', 'VI^7', 'iv7'],
            roots_intervals: [3, 0, 8, 5],
            chord_types: [chord_Major7, chord_Minor7, chord_Major7, chord_Minor7],
            description_he: 'מהלך עגול עם שביעיות מז׳ור ומינור, נשמע נינוח ומלודי.'
        },
        {
            sequence_number: 46,
            symbol_roman: ['i', 'iiø7', 'III^7', 'V7'],
            roots_intervals: [0, 2, 3, 7],
            chord_types: [chord_Minor, chord_HalfDiminished, chord_Major7, chord_Dominant7],
            description_he: 'רצף הרמוני מעניין המשלב סוגי אקורדים שונים לקראת קדנצה.'
        },
        {
            sequence_number: 47,
            symbol_roman: ['i', 'v7', 'iiø7', 'V7'],
            roots_intervals: [0, 7, 2, 7],
            chord_types: [chord_Minor, chord_Minor7, chord_HalfDiminished, chord_Dominant7],
            description_he: 'שימוש ב-v7 כהקדמה ל-iiø7-V7, יוצר מעגל קווינטות רחב.'
        },
        {
            sequence_number: 48,
            symbol_roman: ['i', 'iv', 'VI/bVII', 'VII'],
            roots_intervals: [0, 5, 10, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך מודרני המשתמש באקורד חילוף (Slash Chord) ליצירת תנועת בס מעניינת.'
        },
        {
            sequence_number: 49,
            symbol_roman: ['iiø7', 'VII7/III', 'III^7'],
            roots_intervals: [2, 11, 3],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Major7],
            description_he: 'שימוש ב-VII7 של III ככרומטיזם ליצירת מעבר חלק ל-III^7.'
        },
        {
            sequence_number: 50,
            symbol_roman: ['i', 'iv', 'VII', 'V'],
            roots_intervals: [0, 5, 10, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: 'מהלך מינורי יציב ומתוח, נפוץ במוזיקה קלאסית ובת-זמננו.'
        },
    ];

    // =========================================================================================
    // 3. משתנים גלובליים ומצב האפליקציה + פונקציות עזר
    // =========================================================================================
    let selectedRoot = null; // C, D, E, F, G, A, B
    let selectedAccidental = 'none'; // sharp, flat, none
    let selectedQuality = 'major'; // major, minor
    let currentProgressionIndex = 0;
    let progressionData = ALL_PROGRESSIONS_MAJOR; // יטען את המערך הרלוונטי

    function findNoteByDistance(halfToneDistance) {
        const normalizedDistance = (halfToneDistance % 12 + 12) % 12;
        return ALL_NOTES_ARRAY[normalizedDistance];
    }

    // פונקציה לבניית סולם עם כתיב נכון (דיאז/במול)
    function getScaleNotes(rootNote, scaleObject, accidentalPreference) {
        const notes = [];
        const rootDistance = rootNote.half_tone_distance;

        let isFlatPreference = accidentalPreference === 'flat';
        if (accidentalPreference === 'none') {
            // הכלל הפשוט: אם השורש הוא F, יש במול. אם השורש הוא B בסולם מינור, יש במול.
            isFlatPreference = (rootNote.name_en_primary === 'F' && scaleObject === scale_Major) || 
                                (rootNote.name_en_primary === 'B' && scaleObject === scale_Minor);
        }
        
        for (const interval of scaleObject.intervals) {
            const currentDistance = (rootDistance + interval) % 12;
            const noteObj = findNoteByDistance(currentDistance);

            const displayedNote = { distance: currentDistance, name_en: '', name_he: '' };

            if (currentDistance === 0 || currentDistance === 2 || currentDistance === 4 || currentDistance === 5 || currentDistance === 7 || currentDistance === 9 || currentDistance === 11) {
                // תו טבעי
                displayedNote.name_en = noteObj.name_en_primary;
                displayedNote.name_he = noteObj.name_he_primary;
            } else {
                // תו שחור (דיאז/במול)
                if (isFlatPreference) {
                    displayedNote.name_en = noteObj.name_en_alternate;
                    displayedNote.name_he = noteObj.name_he_alternate;
                } else {
                    displayedNote.name_en = noteObj.name_en_primary;
                    displayedNote.name_he = noteObj.name_he_primary;
                }
            }
            notes.push(displayedNote);
        }
        return notes;
    }

    // פונקציה לבניית אקורד
    function getChordNotes(rootNote, chordType) {
        const notes = [];
        const rootDistance = rootNote.half_tone_distance;
        
        // קביעת העדפת כתיב פשוטה: אם השורש הוא במול או דיאז, נשתמש בזה.
        const isFlatPreference = rootNote.name_en_alternate !== rootNote.name_en_primary && rootNote.name_en_alternate.includes('♭');

        for (const interval of chordType.intervals) {
            const currentDistance = (rootDistance + interval) % 12;
            const noteObj = findNoteByDistance(currentDistance);
            
            const noteData = {};
            if (noteObj.name_en_primary === noteObj.name_en_alternate) {
                noteData.name_en = noteObj.name_en_primary;
                noteData.name_he = noteObj.name_he_primary;
            } else {
                if (isFlatPreference) {
                    noteData.name_en = noteObj.name_en_alternate;
                    noteData.name_he = noteObj.name_he_alternate;
                } else {
                    noteData.name_en = noteObj.name_en_primary;
                    noteData.name_he = noteObj.name_he_primary;
                }
            }
            notes.push(noteData);
        }
        return notes;
    }

    function switchScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.style.display = 'none';
        });
        document.getElementById(screenId).style.display = 'block';
    }

    // =========================================================================================
    // 4. לוגיקת מסך הבית (בחירת סולם)
    // =========================================================================================

    function updateSelection(type, value) {
        if (type === 'note') selectedRoot = value;
        if (type === 'accidental') selectedAccidental = value;
        if (type === 'quality') selectedQuality = value;

        document.querySelectorAll(`.${type}-buttons button`).forEach(btn => {
            btn.classList.remove('selected');
        });
        const selector = type === 'note' ? `[data-note="${value}"]` :
                         type === 'accidental' ? `[data-accidental="${value}"]` :
                         `[data-quality="${value}"]`;
        document.querySelector(selector).classList.add('selected');

        validateSelectionAndEnableButtons();
    }

    function validateSelectionAndEnableButtons() {
        const isValid = selectedRoot !== null;
        document.getElementById('practice-scale-btn').disabled = !isValid;
        document.getElementById('practice-chords-btn').disabled = !isValid;
    }

    function selectRandomScale() {
        const rootNotes = Object.keys(BASE_NOTE_DISTANCES);
        updateSelection('note', rootNotes[Math.floor(Math.random() * rootNotes.length)]);
        
        const accidentals = ['none', 'sharp', 'flat'];
        updateSelection('accidental', accidentals[Math.floor(Math.random() * accidentals.length)]);
        
        const qualities = ['major', 'minor'];
        updateSelection('quality', qualities[Math.floor(Math.random() * qualities.length)]);
    }
    
    // הגדרת מאזינים לכפתורי הבחירה
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.note-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('note', e.target.dataset.note));
        });
        document.querySelectorAll('.accidental-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('accidental', e.target.dataset.accidental));
        });
        document.querySelectorAll('.quality-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('quality', e.target.dataset.quality));
        });
        
        // בחירת ברירת מחדל
        if (selectedRoot === null) {
            updateSelection('note', 'C');
        }
        validateSelectionAndEnableButtons();
    });

    // =========================================================================================
    // 5. לוגיקת תרגול סולם
    // =========================================================================================

    function startScalePractice() {
        const rootDistance = BASE_NOTE_DISTANCES[selectedRoot];
        let finalDistance = rootDistance;
        let accidentalSymbol = '';

        if (selectedAccidental === 'sharp') {
            finalDistance = (rootDistance + 1) % 12;
            accidentalSymbol = '♯';
        } else if (selectedAccidental === 'flat') {
            finalDistance = (rootDistance - 1 + 12) % 12;
            accidentalSymbol = '♭';
        }

        const rootNoteObject = findNoteByDistance(finalDistance);
        
        // בניית שם הסולם
        let displayedRootName = selectedRoot;
        if (selectedAccidental === 'sharp') displayedRootName += '♯';
        if (selectedAccidental === 'flat') displayedRootName += '♭';

        const scaleName = `${displayedRootName} ${selectedQuality === 'major' ? scale_Major.name_he : scale_Minor.name_he}`;
        document.getElementById('scale-title').textContent = scaleName;

        const scaleObject = selectedQuality === 'major' ? scale_Major : scale_Minor;
        
        // 1. תצוגת מרווחים בין תו לתו
        const intervalsContainer = document.getElementById('scale-intervals-container');
        intervalsContainer.innerHTML = '';
        scaleObject.step_intervals_he.forEach((interval) => {
            const intervalEl = document.createElement('div');
            intervalEl.className = 'interval-item';
            intervalEl.textContent = interval;
            intervalsContainer.appendChild(intervalEl);
        });

        // 2. איפוס ושמירת נתונים לתצוגת התווים
        const notesContainer = document.getElementById('scale-notes-container');
        notesContainer.innerHTML = '';
        notesContainer.dataset.rootDistance = rootNoteObject.half_tone_distance;
        notesContainer.dataset.accidentalPreference = selectedAccidental;
        notesContainer.dataset.quality = selectedQuality;
        
        document.getElementById('notes-label').style.display = 'none';

        switchScreen('scale-practice-screen');
    }

    function showScaleNotes() {
        const notesContainer = document.getElementById('scale-notes-container');
        
        if (notesContainer.innerHTML !== '') return; // אם התווים כבר מוצגים
        
        const rootDistance = parseInt(notesContainer.dataset.rootDistance);
        const accidentalPreference = notesContainer.dataset.accidentalPreference;
        const quality = notesContainer.dataset.quality;

        const scaleObject = quality === 'major' ? scale_Major : scale_Minor;
        const rootNoteObject = findNoteByDistance(rootDistance);

        const notes = getScaleNotes(rootNoteObject, scaleObject, accidentalPreference);

        notes.forEach(note => {
            const noteEl = document.createElement('div');
            noteEl.className = 'result-item';
            noteEl.innerHTML = `
                ${note.name_en}
                <span class="hebrew-name">${note.name_he}</span>
            `;
            notesContainer.appendChild(noteEl);
        });

        document.getElementById('notes-label').style.display = 'block';
    }


    // =========================================================================================
    // 6. לוגיקת תרגול מהלכי אקורדים
    // =========================================================================================

    function startChordPractice() {
        // איפוס האינדקס ובחירת מערך המהלכים הרלוונטי
        progressionData = selectedQuality === 'major' ? ALL_PROGRESSIONS_MAJOR : ALL_PROGRESSIONS_MINOR;
        currentProgressionIndex = 0;
        
        // איפוס המתג (כבוי כברירת מחדל)
        document.getElementById('toggle-chord-names').checked = false;
        
        displayCurrentProgression();
        switchScreen('progression-practice-screen');
    }

    function changeProgression(step) {
        currentProgressionIndex = (currentProgressionIndex + step) % progressionData.length;
        if (currentProgressionIndex < 0) {
            currentProgressionIndex = progressionData.length - 1;
        }
        displayCurrentProgression();
    }

    function displayCurrentProgression() {
        if (progressionData.length === 0) return;

        const progression = progressionData[currentProgressionIndex];
        const container = document.getElementById('current-progression-container');
        container.innerHTML = '';
        
        // חישוב שורש הסולם הנבחר
        const rootDistance = BASE_NOTE_DISTANCES[selectedRoot];
        let finalDistance = rootDistance;
        
        if (selectedAccidental === 'sharp') {
            finalDistance = (rootDistance + 1) % 12;
        } else if (selectedAccidental === 'flat') {
            finalDistance = (rootDistance - 1 + 12) % 12;
        }
        const rootNoteObject = findNoteByDistance(finalDistance);
        
        let accidentalSymbol = '';
        if (selectedAccidental === 'sharp') accidentalSymbol = '♯';
        if (selectedAccidental === 'flat') accidentalSymbol = '♭';

        const scaleName = `${selectedRoot}${accidentalSymbol} ${selectedQuality === 'major' ? scale_Major.name_he : scale_Minor.name_he}`;

        document.getElementById('progression-title').textContent = `מהלך ${progression.sequence_number} מתוך ${progressionData.length} בסולם ${scaleName}`;
        document.getElementById('progression-description').textContent = progression.description_he;

        // --- שינוי JS חדש: קריאת מצב המתג ---
        const shouldHideNames = document.getElementById('toggle-chord-names').checked;
        // --- סוף שינוי JS ---

        progression.roots_intervals.forEach((intervalFromRoot, index) => {
            const chordType = progression.chord_types[index];
            const romanSymbol = progression.symbol_roman[index];

            // 1. חישוב שורש האקורד הנוכחי
            const chordRootDistance = (finalDistance + intervalFromRoot) % 12;
            const chordRootNote = findNoteByDistance(chordRootDistance);
            
            // 2. יצירת שם האקורד תוך שימוש בכתיב של השורש הנבחר (דיאז/במול)
            let chordRootNameEn = chordRootNote.name_en_primary;
            if (selectedAccidental === 'flat' && chordRootNote.name_en_alternate !== chordRootNote.name_en_primary) {
                chordRootNameEn = chordRootNote.name_en_alternate;
            } else if (selectedAccidental === 'sharp' && chordRootNote.name_en_primary.includes('♭')) {
                chordRootNameEn = chordRootNote.name_en_primary;
            }
            
            const chordName = chordRootNameEn + chordType.symbol_suffix;

            const stepEl = document.createElement('div');
            stepEl.className = 'progression-step';
            stepEl.setAttribute('tabindex', 0);
            stepEl.dataset.rootDistance = chordRootNote.half_tone_distance;
            stepEl.dataset.chordType = chordType.symbol_suffix;
            stepEl.dataset.roman = romanSymbol;
            stepEl.dataset.fullChordName = chordName;
            
            stepEl.onclick = () => openChordModal(chordRootNote, chordType, romanSymbol, chordName);

            // --- שינוי JS חדש: התניית הצגת שם האקורד ---
            const chordNameHTML = shouldHideNames ? 
                '' : // אם המתג פועל (מוסתר), הצג מחרוזת ריקה
                `<div class="chord-name">${chordName}</div>`; // אחרת, הצג את שם האקורד

            stepEl.innerHTML = `
                <div class="roman-numeral">${romanSymbol}</div>
                ${chordNameHTML}
            `;
            // --- סוף שינוי JS ---

            container.appendChild(stepEl);
        });
    }

    function openChordModal(rootNote, chordType, romanSymbol, fullChordName) {
        // מחשב את תווי האקורד
        const notes = getChordNotes(rootNote, chordType);
        
        document.getElementById('modal-chord-title').textContent = `${fullChordName} (${romanSymbol}) - אקורד ${chordType.name_he}`;
        document.getElementById('modal-description').textContent = chordType.description_he;
        
        const notesDisplay = document.getElementById('modal-notes-display');
        notesDisplay.innerHTML = '';

        // הצגת תווי האקורד (LTR)
        notes.forEach(note => {
            const noteEl = document.createElement('div');
            noteEl.className = 'modal-note';
            noteEl.innerHTML = `
                ${note.name_en}
                <span class="hebrew-name">${note.name_he}</span>
            `;
            notesDisplay.appendChild(noteEl);
        });

        document.getElementById('chord-modal').classList.add('active');
    }

    function closeChordModal() {
        document.getElementById('chord-modal').classList.remove('active');
    }

</script>
</body>
</html>
