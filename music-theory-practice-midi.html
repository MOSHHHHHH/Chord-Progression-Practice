<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×¨×’×•×œ ×ª××•×¨×™×” ××•×–×™×§×œ×™×ª</title>
        <!-- ×”×•×¡×¤×ª ×¤×•× ×˜ Heebo ×’×œ×•×‘×œ×™ ×œ×©×™×¤×•×¨ ×”××¨××” ×”×¢×‘×¨×™ -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* ××™×¤×•×¡ ×•×¢×™×¦×•×‘ ×‘×¡×™×¡×™ */
        :root {
            --primary-color: #3b82f6; /* ×›×—×•×œ */
            --secondary-color: #f59e0b; /* ×›×ª×•× */
            --bg-color: #f9fafb; /* ×¨×§×¢ ×‘×”×™×¨ */
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-radius-lg: 1rem;
            --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.2s ease-in-out;
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            padding: 30px;
            direction: rtl; /* ×›×™×•×•×Ÿ ×›×ª×™×‘×” ×›×œ×œ×™ ×¢×‘×¨×™ */
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        /* ×›×¤×ª×•×¨×™× ×•×¤×§×“×™× */
        .controls-group, .note-buttons, .accidental-buttons, .quality-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            background-color: var(--card-bg);
            border: 2px solid #e5e7eb;
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            min-width: 40px;
        }

        button:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        button.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 6px 10px rgba(59, 130, 246, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ×¢×™×§×¨×™×™× */
        .action-buttons button {
            flex-grow: 1;
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
            font-size: 1.1rem;
            padding: 12px 20px;
        }

        .action-buttons button:hover {
            background-color: #f97316;
            border-color: #f97316;
        }

        /* ×›×¤×ª×•×¨×™ ×“×™××–/×‘××•×œ */
        .accidental-buttons button {
            min-width: 60px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* ×ª×¦×•×’×ª ×ª×•×¦××•×ª (LTR) */
        .result-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius-lg);
            background-color: #fff;
            direction: ltr; /* ×™×™×©×•×¨ ×”×ª×•×¦××•×ª ××©×××œ ×œ×™××™×Ÿ */
        }
        
        .result-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            min-width: 80px;
            border: 2px solid var(--primary-color);
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: bold;
            transition: var(--transition);
            background-color: #eff6ff; /* ×›×—×•×œ ×‘×”×™×¨ */
        }
        
        .result-item:hover {
            transform: scale(1.05);
            box-shadow: var(--box-shadow);
        }
        
        .result-item .hebrew-name {
            font-size: 0.9rem;
            font-weight: normal;
            margin-top: 5px;
            color: #4b5563;
        }

        /* ×ª×¦×•×’×ª ××”×œ×›×™ ××§×•×¨×“×™× */
        .progression-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            cursor: pointer;
            transition: var(--transition);
            min-width: 80px;
        }
        
        .progression-step:hover {
            background-color: #f3f4f6;
            border-radius: 0.75rem;
        }
        
        .roman-numeral {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
            letter-spacing: -1px;
        }
        
        .chord-name {
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-color);
        }

        /* ××•×“×œ ××™×“×¢ ×¢×œ ××§×•×¨×“ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            max-width: 450px;
            width: 90%;
            direction: rtl;
            animation: fadeIn 0.3s;
        }
        
        .modal-content h3 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .modal-notes-display {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            direction: ltr; /* ×ª×•×•×™ ×”××§×•×¨×“ ××©×××œ ×œ×™××™×Ÿ */
            justify-content: center;
        }
        
        .modal-note {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 0.5rem;
            font-weight: bold;
        }
        
        .modal-note .hebrew-name {
            font-size: 0.8rem;
            font-weight: normal;
        }
        
        .modal-description {
            background-color: #f3f4f6;
            padding: 15px;
            border-radius: 0.5rem;
            line-height: 1.6;
            text-align: right;
            margin-bottom: 20px;
        }
        
        .modal-close-button {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* ××¡×š ×ª×¨×’×•×œ ×¡×•×œ× - ××¨×•×•×—×™× */
        .scale-intervals-display {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            direction: ltr; /* ××¨×•×•×—×™× ××©×××œ ×œ×™××™×Ÿ */
            flex-wrap: wrap;
        }
        
        .interval-item {
            padding: 8px 15px;
            background-color: #fee2e2; /* ××“×•× ×‘×”×™×¨ */
            color: #dc2626; /* ××“×•× ×›×”×” */
            border-radius: 0.5rem;
            font-weight: bold;
            font-size: 0.9rem;
            border: 1px solid #fca5a5;
        }

        /* ×× ×™××¦×™×•×ª */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === ×ª×•×¡×¤×ª CSS ×—×“×©×”: ×¢×™×¦×•×‘ ××ª×’ (Toggle Switch) === */
        .toggle-switch-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .toggle-switch-label {
            font-weight: 500;
            color: var(--text-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* === ×ª×•×¡×¤×•×ª ×¢×‘×•×¨ ××¦×‘ MIDI === */

        /* ×”×“×’×©×ª ×”××§×•×¨×“ ×”× ×•×›×—×™ ×©×¦×¨×™×š ×œ× ×’×Ÿ */
        .progression-step.current-target {
            border-color: var(--secondary-color);
            background-color: #fff7ed; /* ×›×ª×•× ×‘×”×™×¨ ×××•×“ */
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
            z-index: 10;
            border-radius: 0.75rem; /* ×”×•×¡×¤×ª ×¨×“×™×•×¡ ×œ×”×“×’×©×” ×™×¤×” ×™×•×ª×¨ */
            border: 2px solid var(--secondary-color); /* ×©×™×”×™×” ×’×‘×•×œ ×‘×¨×•×¨ */
        }

        /* ×”×•×“×¢×ª ×©×’×™××” ×¦×¤×” */
        .error-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ef4444; /* ××“×•× */
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.5);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none; /* ×©×œ× ×™×¤×¨×™×¢ ×œ×œ×—×™×¦×•×ª */
        }

        .error-toast.show {
            opacity: 1;
        }

        /* ×›×¤×ª×•×¨ MIDI ×‘×“×£ ×”×‘×™×ª */
        .midi-btn {
            background-color: #8b5cf6 !important; /* ×¡×’×•×œ ×œ×”×¤×¨×“×” */
            border-color: #8b5cf6 !important;
        }
        .midi-btn:hover {
            background-color: #7c3aed !important;
        }
        
    </style>
</head>
<body>

    <div class="app-container">
        <h1>×ª×¨×’×•×œ ×”×¨××•× ×™</h1>
        
        <div id="home-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 20px;">×‘×—×¨ ×¡×•×œ× ×œ×ª×¨×’×•×œ</h2>

            <div class="controls-group">
                <div class="note-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">×ª×• ×©×•×¨×©</p>
                    <button data-note="C">C (×“×•)</button>
                    <button data-note="D">D (×¨×”)</button>
                    <button data-note="E">E (××™)</button>
                    <button data-note="F">F (×¤×)</button>
                    <button data-note="G">G (×¡×•×œ)</button>
                    <button data-note="A">A (×œ×”)</button>
                    <button data-note="B">B (×¡×™)</button>
                </div>
                
                <div class="accidental-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">×“×™××– / ×‘××•×œ</p>
                    <button data-accidental="sharp">â™¯</button>
                    <button data-accidental="none" class="selected">×˜×‘×¢×™</button>
                    <button data-accidental="flat">â™­</button>
                </div>
                
                <div class="quality-buttons">
                    <p style="width: 100%; text-align: center; font-weight: bold; margin-bottom: 10px;">×¡×•×’ ×¡×•×œ×</p>
                    <button data-quality="major" class="selected">××–'×•×¨</button>
                    <button data-quality="minor">××™× ×•×¨</button>
                </div>
            </div>

            <div class="action-buttons controls-group" style="margin-top: 30px;">
                <button onclick="selectRandomScale()">××§×¨××™</button>
                <button id="practice-scale-btn" onclick="startScalePractice()" disabled>×ª×¨×’×•×œ ×¡×•×œ×</button>
                <button id="practice-chords-btn" onclick="startChordPractice()" disabled>×ª×¨×’×•×œ ××”×œ×›×™ ××§×•×¨×“×™×</button>
                <button id="practice-midi-btn" class="midi-btn" onclick="startMidiPractice()" disabled>×ª×¨×’×œ ×¢× MIDI ğŸ¹</button>
            </div>
        </div>

        <div id="scale-practice-screen" class="screen" style="display: none;">
            <h2 id="scale-title" style="text-align: center; margin-bottom: 20px; color: var(--secondary-color);"></h2>
            
            <p style="text-align: center; font-weight: 500;">××¨×•×•×—×™× ×‘×™×Ÿ ×ª×• ×œ×ª×• (LTR):</p>
            <div id="scale-intervals-container" class="scale-intervals-display">
                </div>

            <div class="controls-group" style="margin-top: 30px; justify-content: center;">
                <button id="show-notes-btn" onclick="showScaleNotes()">×”×¦×’ ××ª ×”×ª×•×•×™×</button>
            </div>

            <p style="text-align: center; font-weight: 500; margin-top: 20px; display: none;" id="notes-label">×ª×•×•×™ ×”×¡×•×œ× (LTR):</p>
            <div id="scale-notes-container" class="result-display">
                </div>

            <div class="controls-group" style="margin-top: 40px;">
                <button onclick="switchScreen('home-screen')">×—×–×•×¨ ×œ×‘×™×ª</button>
            </div>
        </div>

        <div id="progression-practice-screen" class="screen" style="display: none;">
            <h2 id="progression-title" style="text-align: center; margin-bottom: 30px; color: var(--secondary-color);"></h2>

            <div class="toggle-switch-container">
                <label for="toggle-chord-names" class="toggle-switch-label">×”×¡×ª×¨ ×©××•×ª ××§×•×¨×“×™×</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-chord-names" onchange="displayCurrentProgression()">
                    <span class="slider round"></span>
                </label>
            </div>
            <div id="current-progression-container" class="result-display" style="justify-content: space-around; min-height: 120px; flex-wrap: nowrap; overflow-x: auto;">
                </div>
            
            <p id="progression-description" style="text-align: center; margin-top: 15px; font-style: italic; color: #4b5563;"></p>

            <div class="controls-group" style="margin-top: 40px;">
                <button onclick="changeProgression(-1)">×§×•×“×</button>
                <button onclick="changeProgression(1)">×”×‘×</button>
            </div>
            
            <div class="controls-group">
                <button onclick="switchScreen('home-screen')">×—×–×•×¨ ×œ×“×£ ×”×‘×™×ª</button>
            </div>
        </div>
        
    </div>
    
    <div id="chord-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-chord-title"></h3>
            
            <p style="font-weight: bold; text-align: right; margin-bottom: 10px;">×ª×•×•×™× ××¨×›×™×‘×™× (LTR):</p>
            <div id="modal-notes-display" class="modal-notes-display">
                </div>
            
            <p style="font-weight: bold; text-align: right; margin-bottom: 10px;">×”×¡×‘×¨ ×”×¨××•× ×™:</p>
            <div id="modal-description" class="modal-description">
                </div>
            
            <button id="modal-close-button" class="modal-close-button" onclick="closeChordModal()">×”×‘× ×ª×™</button>
        </div>
    </div>
    
    <div id="error-toast" class="error-toast">×˜×¢×•×ª! ×—×–×¨×” ×œ×”×ª×—×œ×”...</div>

<script>
    // =========================================================================================
    // 1. ×”×˜××¢×ª ×§×‘×¦×™ ×”-JS: Notes, Chords, Scales
    // =========================================================================================

    // --- notes_data.js ---
    // ×”×’×“×¨×•×ª ×”×§×œ×™×“×™× (×¦×œ×™×œ×™×) ×‘××•×§×˜×‘×” ××—×ª
    const note_C1 = { name_en_primary: 'C', name_en_alternate: 'C', name_he_primary: '×“×•', name_he_alternate: '×“×•', half_tone_distance: 0 };
    const note_CSharp1 = { name_en_primary: 'Câ™¯', name_en_alternate: 'Dâ™­', name_he_primary: '×“×• ×“×™××–', name_he_alternate: '×¨×” ×‘××•×œ', half_tone_distance: 1 };
    const note_D1 = { name_en_primary: 'D', name_en_alternate: 'D', name_he_primary: '×¨×”', name_he_alternate: '×¨×”', half_tone_distance: 2 };
    const note_DSharp1 = { name_en_primary: 'Dâ™¯', name_en_alternate: 'Eâ™­', name_he_primary: '×¨×” ×“×™××–', name_he_alternate: '××™ ×‘××•×œ', half_tone_distance: 3 };
    const note_E1 = { name_en_primary: 'E', name_en_alternate: 'E', name_he_primary: '××™', name_he_alternate: '××™', half_tone_distance: 4 };
    const note_F1 = { name_en_primary: 'F', name_en_alternate: 'F', name_he_primary: '×¤×', name_he_alternate: '×¤×', half_tone_distance: 5 };
    const note_FSharp1 = { name_en_primary: 'Fâ™¯', name_en_alternate: 'Gâ™­', name_he_primary: '×¤× ×“×™××–', name_he_alternate: '×¡×•×œ ×‘××•×œ', half_tone_distance: 6 };
    const note_G1 = { name_en_primary: 'G', name_en_alternate: 'G', name_he_primary: '×¡×•×œ', name_he_alternate: '×¡×•×œ', half_tone_distance: 7 };
    const note_GSharp1 = { name_en_primary: 'Gâ™¯', name_en_alternate: 'Aâ™­', name_he_primary: '×¡×•×œ ×“×™××–', name_he_alternate: '×œ×” ×‘××•×œ', half_tone_distance: 8 };
    const note_A1 = { name_en_primary: 'A', name_en_alternate: 'A', name_he_primary: '×œ×”', name_he_alternate: '×œ×”', half_tone_distance: 9 };
    const note_ASharp1 = { name_en_primary: 'Aâ™¯', name_en_alternate: 'Bâ™­', name_he_primary: '×œ×” ×“×™××–', name_he_alternate: '×¡×™ ×‘××•×œ', half_tone_distance: 10 };
    const note_B1 = { name_en_primary: 'B', name_en_alternate: 'B', name_he_primary: '×¡×™', name_he_alternate: '×¡×™', half_tone_distance: 11 };
    
    const ALL_NOTES_ARRAY = [
        note_C1, note_CSharp1, note_D1, note_DSharp1, note_E1, note_F1,
        note_FSharp1, note_G1, note_GSharp1, note_A1, note_ASharp1, note_B1
    ].sort((a, b) => a.half_tone_distance - b.half_tone_distance);
    const BASE_NOTE_DISTANCES = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 };

    // --- chords_data.js ---
    // ×”×’×“×¨×•×ª ×©×œ 10 ×¡×•×’×™ ××§×•×¨×“×™× × ×¤×•×¦×™×
    const chord_Major = { name_he: '××–×³×•×¨', name_en: 'Major', symbol_suffix: '', description_he: '×”××§×•×¨×“ ×”×‘×¡×™×¡×™, ××•×¨×›×‘ ××¤×¨×™××”, ×˜×¨×¦×” ×’×“×•×œ×” (4 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ×–×›×” (7 ×—×¦××™ ×˜×•× ×™×).', intervals: [0, 4, 7] };
    const chord_Minor = { name_he: '××™× ×•×¨', name_en: 'Minor', symbol_suffix: 'm', description_he: '××§×•×¨×“ ×‘×¢×œ ××•×¤×™ × ×•×’×”, ××•×¨×›×‘ ××¤×¨×™××”, ×˜×¨×¦×” ×§×˜× ×” (3 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ×–×›×”.', intervals: [0, 3, 7] };
    const chord_Dominant7 = { name_he: '×“×•××™× × ×˜ 7', name_en: 'Dominant 7th', symbol_suffix: '7', description_he: '××§×•×¨×“ ×¢× ××ª×— ×—×–×§ (×˜×¨×™×˜×•×Ÿ), ×¨×•×¦×” ×œ×”×™×¤×ª×¨ ×œ×˜×•× ×™×§×”. ××•×¨×›×‘ ××˜×¨×¦×” ×’×“×•×œ×”, ×§×•×•×™× ×˜×” ×–×›×” ×•×©×‘×™×¢×™×ª ×§×˜× ×” (10 ×—×¦××™ ×˜×•× ×™×).', intervals: [0, 4, 7, 10] };
    const chord_Major7 = { name_he: '××–×³×•×¨ 7', name_en: 'Major 7th', symbol_suffix: 'maj7', description_he: '××§×•×¨×“ ×™×¦×™×‘ ×•×¨×š, ×¢× ×©×‘×™×¢×™×ª ×’×“×•×œ×” (11 ×—×¦××™ ×˜×•× ×™×).', intervals: [0, 4, 7, 11] };
    const chord_Minor7 = { name_he: '××™× ×•×¨ 7', name_en: 'Minor 7th', symbol_suffix: 'm7', description_he: '××§×•×¨×“ ×¨×’×•×¢ ×•× ×™× ×•×—, ××©××© ×¨×‘×•×ª ×‘×’×³××– ×•×‘×¤×™×•×–×³×Ÿ, ×¢× ×˜×¨×¦×” ×§×˜× ×” ×•×©×‘×™×¢×™×ª ×§×˜× ×”.', intervals: [0, 3, 7, 10] };
    const chord_HalfDiminished = { name_he: '××™× ×•×¨ 7b5', name_en: 'Minor 7th flat 5 (Half-Diminished)', symbol_suffix: 'm7b5', description_he: '××§×•×¨×“ ××•×¨×›×‘ ×¢× ××ª×— ×—×–×§, ××©××© ×‘×¢×™×§×¨ ×‘××•×–×™×§×ª ×’×³××–, ×¢× ×§×•×•×™× ×˜×” ××•×§×˜× ×ª (6 ×—×¦××™ ×˜×•× ×™×).', intervals: [0, 3, 6, 10] };
    const chord_Augmented = { name_he: '××•×’×“×œ', name_en: 'Augmented', symbol_suffix: 'aug', description_he: '××§×•×¨×“ ×¢× ×ª×—×•×©×” ×—×œ×•××™×ª ××• ××ª×•×—×”, ×¢× ×§×•×•×™× ×˜×” ××•×’×“×œ×ª (8 ×—×¦××™ ×˜×•× ×™×).', intervals: [0, 4, 8] };
    const chord_Diminished = { name_he: '××•×§×˜×Ÿ', name_en: 'Diminished', symbol_suffix: 'dim', description_he: '××§×•×¨×“ ×œ× ×™×¦×™×‘ ×•×“×¨××˜×™, ×¢× ×˜×¨×¦×” ×§×˜× ×” ×•×§×•×•×™× ×˜×” ××•×§×˜× ×ª.', intervals: [0, 3, 6] };
    const chord_Sus4 = { name_he: '×¡××¡ 4', name_en: 'Suspended 4th', symbol_suffix: 'sus4', description_he: '××§×•×¨×“ ×œ×œ× ×˜×¨×¦×”, ×‘××§×•××” ×™×© ×§×•×•×¨×˜×” (5 ×—×¦××™ ×˜×•× ×™×), ×™×•×¦×¨ ×ª×—×•×©×ª ×”××ª× ×”.', intervals: [0, 5, 7] };
    const chord_Sus2 = { name_he: '×¡××¡ 2', name_en: 'Suspended 2nd', symbol_suffix: 'sus2', description_he: '××§×•×¨×“ ×œ×œ× ×˜×¨×¦×”, ×‘××§×•××” ×™×© ×¡×§×•× ×“×” ×’×“×•×œ×” (2 ×—×¦××™ ×˜×•× ×™×), ×™×•×¦×¨ ×ª×—×•×©×ª ×¤×ª×™×—×•×ª.', intervals: [0, 2, 7] };
    const ALL_CHORDS_MAP = { 'Major': chord_Major, 'Minor': chord_Minor, 'Dominant7': chord_Dominant7, 'Major7': chord_Major7, 'Minor7': chord_Minor7, 'HalfDiminished': chord_HalfDiminished, 'Augmented': chord_Augmented, 'Diminished': chord_Diminished, 'Sus4': chord_Sus4, 'Sus2': chord_Sus2 };

    // --- scales_data.js ---
    // ×”×’×“×¨×•×ª ×¡×•×œ××•×ª ×‘×¡×™×¡×™×™× (××–'×•×¨ ×•××™× ×•×¨)
    const scale_Major = {
        name_he: '××–×³×•×¨',
        name_en: 'Major',
        description_he: '×¡×•×œ× ××©××— ×•×‘×”×™×¨, ××‘×Ÿ ×”×‘× ×™×™×Ÿ ×”×‘×¡×™×¡×™×ª ×©×œ ×”××•×–×™×§×” ×”××¢×¨×‘×™×ª.',
        intervals: [0, 2, 4, 5, 7, 9, 11],
        step_intervals_he: ['×˜×•×Ÿ', '×˜×•×Ÿ', '×—×¦×™ ×˜×•×Ÿ', '×˜×•×Ÿ', '×˜×•×Ÿ', '×˜×•×Ÿ', '×—×¦×™ ×˜×•×Ÿ']
    };

    const scale_Minor = {
        name_he: '××™× ×•×¨ ×˜×‘×¢×™',
        name_en: 'Natural Minor',
        description_he: '×¡×•×œ× ×‘×¢×œ ××•×¤×™ × ×•×’×” ×•××œ× ×›×•×œ×™, ×™×—×¡×™ ×œ×¡×•×œ× ×”××–×³×•×¨ (×”×™×—×¡×™).',
        intervals: [0, 2, 3, 5, 7, 8, 10],
        step_intervals_he: ['×˜×•×Ÿ', '×—×¦×™ ×˜×•×Ÿ', '×˜×•×Ÿ', '×˜×•×Ÿ', '×—×¦×™ ×˜×•×Ÿ', '×˜×•×Ÿ', '×˜×•×Ÿ']
    };

    // =========================================================================================
    // 2. ×”×˜××¢×ª ×§×‘×¦×™ ×”-JS: ××”×œ×›×™ ××§×•×¨×“×™× (Progressions) - ××œ××™×
    // =========================================================================================

    // --- chord_progressions_maj.js (××œ×) ---
    // ××¨×•×•×—×™ ×”×©×•×¨×©×™× (Roots) ×”×“×™××˜×•× ×™×™× ×‘×¡×•×œ× ××–'×•×¨: I=0, ii=2, iii=4, IV=5, V=7, vi=9, viiÂ°=11
    const ALL_PROGRESSIONS_MAJOR = [
        // === ×§×‘×•×¦×” 1: ×§×œ (×”×›×™ × ×¤×•×¥, ××©×•×œ×©×™× ×‘×œ×‘×“) ===
        {
            sequence_number: 1,
            symbol_roman: ['I', 'IV', 'V', 'I'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×”×¤×•×¤ ×•×”×¨×•×§ ×”×‘×¡×™×¡×™ ×‘×™×•×ª×¨, ×‘×¢×œ ×ª×—×•×©×ª ×¡×™×•× ×—×–×§×” (×§×“× ×¦×” ××•×©×œ××ª).'
        },
        {
            sequence_number: 2,
            symbol_roman: ['I', 'vi', 'IV', 'V'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š "×”×§×“× ×¦×” ×”×¤×›×¤×›×”", × ×¤×•×¥ ×××•×“ ×‘×©×™×¨×™ ×¤×•×¤, ×™×•×¦×¨ ×ª×—×•×©×” ×©×œ ×”××©×›×™×•×ª.'
        },
        {
            sequence_number: 3,
            symbol_roman: ['ii', 'V', 'I'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major],
            description_he: '×§×“× ×¦×” ×‘×¡×™×¡×™×ª ×‘×’×³××– ×•×‘××•×–×™×§×” ×§×œ××¡×™×ª, ××ª×—×–×§×ª ××ª ×”×˜×•× ×™×§×”.'
        },
        {
            sequence_number: 4,
            symbol_roman: ['I', 'V', 'vi', 'IV'],
            roots_intervals: [0, 7, 9, 5],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Major],
            description_he: '××”×œ×š ×”×¤×•×¤ ×”××¤×•×¨×¡× ("4 ××§×•×¨×“×™×"), × ×©××¢ ×˜×•×‘ ×‘×›×œ ×¡×’× ×•×Ÿ.'
        },
        {
            sequence_number: 5,
            symbol_roman: ['I', 'iii', 'vi', 'IV'],
            roots_intervals: [0, 4, 9, 5],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: '××”×œ×š ×¨×’×•×¢ ×•××œ×•×“×™, ×¢×•×‘×¨ ×“×¨×š ×”×“×¨×’×” ×”×©×œ×™×©×™×ª ×”××™× ×•×¨×™×ª.'
        },
        {
            sequence_number: 6,
            symbol_roman: ['vi', 'IV', 'I', 'V'],
            roots_intervals: [9, 5, 0, 7],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '×•×¨×™××¦×™×” ×©×œ ××”×œ×š ×”×¤×•×¤ ×”××ª×—×™×œ×” ×‘×“×¨×’×” ×”××™× ×•×¨×™×ª ×”×©×™×©×™×ª.'
        },
        {
            sequence_number: 7,
            symbol_roman: ['I', 'IV', 'I', 'V'],
            roots_intervals: [0, 5, 0, 7],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¤×©×•×˜ ×•×‘×˜×•×—, ××ª××™× ×œ×©×™×¨×™× ×§×œ×™×œ×™× ×•×¢×××™×™×.'
        },
        {
            sequence_number: 8,
            symbol_roman: ['iii', 'vi', 'ii', 'V'],
            roots_intervals: [4, 9, 2, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Major],
            description_he: '×¨×¦×£ ×™×•×¨×“ ×©×œ ××§×•×¨×“×™× ×”××›×™×Ÿ ××ª ×”×§×¨×§×¢ ×œ×§×“× ×¦×” V-I.'
        },
        {
            sequence_number: 9,
            symbol_roman: ['I', 'IV', 'V', 'vi'],
            roots_intervals: [0, 5, 7, 9],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Minor],
            description_he: '××”×œ×š × ×“×™×¨ ×™×—×¡×™×ª ×”××©×ª××© ×‘-vi ×›× ×§×•×“×ª ×ª× ×•×¢×” ×œ××—×•×¨.'
        },
        {
            sequence_number: 10,
            symbol_roman: ['ii', 'I', 'V', 'IV'],
            roots_intervals: [2, 0, 7, 5],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ××§×•×¨×“×™× ×”××©×ª××© ×‘×“×¨×’×” ii ×›×“×™ ×œ×”×’×™×¢ ×—×–×¨×” ×œ×˜×•× ×™×§×”.'
        },
        // === ×§×‘×•×¦×” 2: ×‘×™× ×•× ×™ (×©×‘×™×¢×™×•×ª ×•×¡××¡×¤× ×“×™×) ===
        {
            sequence_number: 11,
            symbol_roman: ['I', 'V7', 'I', 'IV'],
            roots_intervals: [0, 7, 0, 5],
            chord_types: [chord_Major, chord_Dominant7, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘-V7 (×“×•××™× × ×˜ 7) ×œ×”×“×’×©×ª ×”×§×“× ×¦×” ×œ-I.'
        },
        {
            sequence_number: 12,
            symbol_roman: ['ii7', 'V7', 'Imaj7'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: '×”×§×“× ×¦×” ×”×’×³××–×™×ª ×”×§×œ××¡×™×ª (ii-V-I) ×¢× ×©×‘×™×¢×™×•×ª.'
        },
        {
            sequence_number: 13,
            symbol_roman: ['Imaj7', 'IVmaj7', 'ii7', 'V7'],
            roots_intervals: [0, 5, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: '××”×œ×š ×”×¨××•× ×™ ×—×œ×§, × ×¤×•×¥ ×‘××•×–×™×§×ª ×œ××•× ×’×³ ×•×‘×•×¡×” × ×•×‘×”.'
        },
        {
            sequence_number: 14,
            symbol_roman: ['I', 'V(sus4)', 'V', 'I'],
            roots_intervals: [0, 7, 7, 0],
            chord_types: [chord_Major, chord_Sus4, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘××§×•×¨×“ ××•×©×¢×” (sus4) ×›×“×™ ×œ×™×¦×•×¨ ××ª×— ×§×œ ×œ×¤× ×™ ×”×¤×ª×¨×•×Ÿ.'
        },
        {
            sequence_number: 15,
            symbol_roman: ['iii7', 'vi7', 'ii7', 'V7'],
            roots_intervals: [4, 9, 2, 7],
            chord_types: [chord_Minor7, chord_Minor7, chord_Minor7, chord_Dominant7],
            description_he: '×¨×¦×£ ×©×‘×™×¢×™×•×ª ×™×•×¨×“ ×©××•×‘×™×œ ×‘××•×¤×Ÿ ×˜×‘×¢×™ ×œ×§×“× ×¦×” V7.'
        },
        {
            sequence_number: 16,
            symbol_roman: ['IV', 'V', 'vi', 'iii'],
            roots_intervals: [5, 7, 9, 4],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Minor],
            description_he: '××”×œ×š ××ª×•×— ×™×•×ª×¨ ×”×™×•×¦×¨ ×ª×—×•×©×ª ×ª× ×•×¢×” ×¨×¦×™×¤×”.'
        },
        {
            sequence_number: 17,
            symbol_roman: ['Imaj7', 'iii7', 'IVmaj7', 'vi7'],
            roots_intervals: [0, 4, 5, 9],
            chord_types: [chord_Major7, chord_Minor7, chord_Major7, chord_Minor7],
            description_he: '××”×œ×š ×¨×š ×•×™×¦×™×‘ ×”× ×¢ ×‘×™×Ÿ ×©×‘×™×¢×™×•×ª ××–×³×•×¨ ×•××™× ×•×¨.'
        },
        {
            sequence_number: 18,
            symbol_roman: ['vi', 'V', 'IV', 'I'],
            roots_intervals: [9, 7, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×™×•×¨×“ (descending) ×¤×•×¤×•×œ×¨×™ ×‘×¨×•×§, ××ª×—×™×œ ×‘×“×¨×’×” ×”××™× ×•×¨×™×ª.'
        },
        {
            sequence_number: 19,
            symbol_roman: ['I(sus2)', 'I', 'IV', 'V'],
            roots_intervals: [0, 0, 5, 7],
            chord_types: [chord_Sus2, chord_Major, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘-sus2 ×›×§×™×©×•×˜ ×œ×˜×•× ×™×§×” ×œ×¤× ×™ ××¢×‘×¨ ×œ-IV.'
        },
        {
            sequence_number: 20,
            symbol_roman: ['IVmaj7', 'Imaj7', 'ii7', 'V7'],
            roots_intervals: [5, 0, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: '××”×œ×š ××ª×—×œ×£ (plagal) ×©××›×™×Ÿ ×œ-ii-V-I ×’×³××–×™.'
        },
        // === ×§×‘×•×¦×” 3: ××ª×§×“× (×“×™××™× ×™×©×“, ××•×’×“×œ, ×•×“×¨×’×•×ª ××•×©××œ×•×ª) ===
        {
            sequence_number: 21,
            symbol_roman: ['I', 'bIII', 'IV', 'V'],
            roots_intervals: [0, 3, 5, 7],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘-bIII (×“×¨×’×” ××•×©××œ×ª ××”×¡×•×œ× ×”××™× ×•×¨×™) ×œ×™×¦×™×¨×ª ×¦×‘×¢ ×›×¨×•××˜×™.'
        },
        {
            sequence_number: 22,
            symbol_roman: ['I', 'IV', 'bVII', 'IV'],
            roots_intervals: [0, 5, 10, 5],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¨×•×§/×‘×œ×•×– ×¤×•×¤×•×œ×¨×™ ×”××©×ª××© ×‘-bVII (×“×•××™× × ×˜ ××©× ×™).'
        },
        {
            sequence_number: 23,
            symbol_roman: ['I', 'vi', 'ii', 'V7'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Dominant7],
            description_he: '××”×œ×š ×™×¡×•×“×™, ××›×™×Ÿ ××ª ×”-ii-V ×œ×¤×ª×¨×•×Ÿ ×”×“×•××™× × ×˜×™.'
        },
        {
            sequence_number: 24,
            symbol_roman: ['Imaj7', 'vi7', 'ii7', 'V7'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major7, chord_Minor7, chord_Minor7, chord_Dominant7],
            description_he: '×§×“× ×¦×” ×’×³××–×™×ª ××œ××” I-vi-ii-V, ×”×‘×¡×™×¡ ×œ×¡×˜× ×“×¨×˜×™× ×¨×‘×™×.'
        },
        {
            sequence_number: 25,
            symbol_roman: ['I', 'IV', 'viiÂ°', 'iii'],
            roots_intervals: [0, 5, 11, 4],
            chord_types: [chord_Major, chord_Major, chord_Diminished, chord_Minor],
            description_he: '×©×™××•×© ×‘-viiÂ° (×”×“×¨×’×” ×”××•×§×˜× ×ª) ×›×’×©×¨ ×›×¨×•××˜×™ ××ª×•×—.'
        },
        {
            sequence_number: 26,
            symbol_roman: ['V7/IV', 'IV', 'V7', 'I'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Dominant7, chord_Major, chord_Dominant7, chord_Major],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ×”××©× ×™ (V7 ×©×œ IV) ×œ×™×¦×™×¨×ª ××ª×— ×œ×¤× ×™ ×”-IV.'
        },
        {
            sequence_number: 27,
            symbol_roman: ['I', 'V/vi', 'vi', 'IV'],
            roots_intervals: [0, 4, 9, 5],
            chord_types: [chord_Major, chord_Major, chord_Minor, chord_Major],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ××©× ×™ (V ×©×œ vi) ×œ×™×¦×™×¨×ª ××ª×— ×—×–×§ ×œ×¤× ×™ ×”×“×¨×’×” ×”×©×™×©×™×ª.'
        },
        {
            sequence_number: 28,
            symbol_roman: ['I', 'Iaug', 'IV', 'iv'],
            roots_intervals: [0, 0, 5, 5],
            chord_types: [chord_Major, chord_Augmented, chord_Major, chord_Minor],
            description_he: '××¢×‘×¨ ×›×¨×•××˜×™ ×¤× ×™××™ ×‘×××¦×¢×•×ª ××§×•×¨×“ I ××•×’×“×œ ×œ-IV, ×•××©× ×œ-iv ×”××™× ×•×¨×™.'
        },
        {
            sequence_number: 29,
            symbol_roman: ['IV', 'viiÂ°', 'iii', 'vi'],
            roots_intervals: [5, 11, 4, 9],
            chord_types: [chord_Major, chord_Diminished, chord_Minor, chord_Minor],
            description_he: '××”×œ×š ×”××©×ª××© ×‘××§×•×¨×“×™× ×œ× ×¤×•×¤×•×œ×¨×™×™× ×œ×™×¦×™×¨×ª ×¦×‘×¢ ××™×•×—×“.'
        },
        {
            sequence_number: 30,
            symbol_roman: ['Imaj7', 'bIImaj7', 'Imaj7'],
            roots_intervals: [0, 1, 0],
            chord_types: [chord_Major7, chord_Major7, chord_Major7],
            description_he: '××”×œ×š ×›×¨×•××˜×™ ×©×§×˜ (Truck Driver Modulation), × ×¤×•×¥ ×‘×’×³××– ×•×‘××¨×³×× ×‘×™.'
        },
        // === ×§×‘×•×¦×” 4: ×’'××– ×•×¤×™×•×–'×Ÿ (×©×‘×™×¢×™×•×ª ××ª×§×“××•×ª) ===
        {
            sequence_number: 31,
            symbol_roman: ['ii7', 'V7', 'Imaj7', 'IVmaj7'],
            roots_intervals: [2, 7, 0, 5],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7, chord_Major7],
            description_he: '×§×“× ×¦×” ×’×³××–×™×ª ×©××•×‘×™×œ×” ×œ××§×•×¨×“ IVmaj7 ×œ×”××©×›×™×•×ª ×”××”×œ×š.'
        },
        {
            sequence_number: 32,
            symbol_roman: ['iii7', 'bIII7', 'ii7', 'V7'],
            roots_intervals: [4, 3, 2, 7],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Minor7, chord_Dominant7],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ××©× ×™ (bIII7) ×›×›×¨×•××˜×™×–× ×œ×™×¦×™×¨×ª ××ª×— ×™×•×¨×“.'
        },
        {
            sequence_number: 33,
            symbol_roman: ['I', 'vi', 'ii', 'V'],
            roots_intervals: [0, 9, 2, 7],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: '×§×× ×•×Ÿ ×¤×•×¤/×¨×•×§ ×¤×©×•×˜.'
        },
        {
            sequence_number: 34,
            symbol_roman: ['Imaj7', 'bVImaj7', 'ii7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_Minor7, chord_Dominant7],
            description_he: '×©×™××•×© ×‘-bVI (×“×¨×’×” ××•×©××œ×ª) ×›×“×™ ×œ×”×•×¡×™×£ ×’×•×•×Ÿ ××¤×ª×™×¢ ×œ×¤× ×™ ×”-ii-V.'
        },
        {
            sequence_number: 35,
            symbol_roman: ['vi7', 'ii7', 'V7', 'Imaj7'],
            roots_intervals: [9, 2, 7, 0],
            chord_types: [chord_Minor7, chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: '××”×œ×š ×™×¡×•×“×™ ×©××ª×—×™×œ ×‘×“×¨×’×” ×”×©×™×©×™×ª ×•××•×‘×™×œ ×œ×˜×•× ×™×§×” (××¢×’×œ ×”×§×•×•×™× ×˜×•×ª).'
        },
        {
            sequence_number: 36,
            symbol_roman: ['Imaj7', 'bVII7', 'IVmaj7'],
            roots_intervals: [0, 10, 5],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7],
            description_he: '××¢×‘×¨ ×œ×™×“×™ (backdoor) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×” ××”×™×¨×” ×œ-IVmaj7.'
        },
        {
            sequence_number: 37,
            symbol_roman: ['ii7', 'V7(alt)', 'Imaj7'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: '×§×“× ×¦×” ii-V-I ×¢× V7 ××•×—×œ×£ (Alternate) ×œ×”×•×¡×¤×ª ××ª×— ×—×¨×™×£.'
        },
        {
            sequence_number: 38,
            symbol_roman: ['I', 'iii', 'V', 'IV'],
            roots_intervals: [0, 4, 7, 5],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×”××“×œ×’ ×¢×œ ×”-vi ×•××©×ª××© ×‘-iii ×œ×™×¦×™×¨×ª ×’×•×•×Ÿ ×©×•× ×”.'
        },
        {
            sequence_number: 39,
            symbol_roman: ['Imaj7', 'bIIImaj7', 'IVmaj7', 'bVmaj7'],
            roots_intervals: [0, 3, 5, 6],
            chord_types: [chord_Major7, chord_Major7, chord_Major7, chord_Major7],
            description_he: '××”×œ×š ××©×ª× ×” ×‘×××¦×¢×•×ª ××§×•×¨×“×™ ××–×³×•×¨-7 ×›×¨×•××˜×™×™×, × ×©××¢ ××•×“×¨× ×™.'
        },
        {
            sequence_number: 40,
            symbol_roman: ['I', 'V/V', 'V', 'I'],
            roots_intervals: [0, 2, 7, 0],
            chord_types: [chord_Major, chord_Dominant7, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ×”×“×•××™× × ×˜×™ (V ×©×œ V) ×›×“×™ ×œ×”×“×’×™×© ××ª V ×œ×¤× ×™ ×”×˜×•× ×™×§×”.'
        },
        // === ×§×‘×•×¦×” 5: ××•×“×¨× ×™ ×•× ×™×¡×™×•× ×™ ===
        {
            sequence_number: 41,
            symbol_roman: ['IV', 'I', 'V/vi', 'vi'],
            roots_intervals: [5, 0, 4, 9],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Minor],
            description_he: '××”×œ×š ×™×•×¨×“ (Descending) ×”××©×ª××© ×‘-V/vi ×›×“×•××™× × ×˜ ××©× ×™.'
        },
        {
            sequence_number: 42,
            symbol_roman: ['Imaj7', 'V/vi', 'IVmaj7', 'V7/ii'],
            roots_intervals: [0, 4, 5, 9],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7, chord_Dominant7],
            description_he: '×¨×¦×£ ×“×•××™× × ×˜×™× ××©× ×™×™× ×”×™×•×¦×¨ ××ª×— ××ª××©×š.'
        },
        {
            sequence_number: 43,
            symbol_roman: ['I', 'vi', 'IV', 'V'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Major, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×§×œ××¡×™, ××š × ×©××¢ × ×›×•×Ÿ ×’× ×‘××•×–×™×§×” ×¢×“×›× ×™×ª.'
        },
        {
            sequence_number: 44,
            symbol_roman: ['I', 'V(sus4)', 'vi', 'V(sus4)'],
            roots_intervals: [0, 7, 9, 7],
            chord_types: [chord_Major, chord_Sus4, chord_Minor, chord_Sus4],
            description_he: '×©×™××•×© ×—×•×–×¨ ×‘-sus4 ×œ×™×¦×™×¨×ª ×ª×—×•×©×” ×¦×¤×” ×•× ×•×§×©×” ×¤×—×•×ª.'
        },
        {
            sequence_number: 45,
            symbol_roman: ['I', 'bVI', 'bVII', 'I'],
            roots_intervals: [0, 8, 10, 0],
            chord_types: [chord_Major, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¨×•×§ ×›×‘×“ ×”××©×ª××© ×‘×“×¨×’×•×ª ××•×©××œ×•×ª (bVI, bVII) ×œ×™×¦×™×¨×ª ×¦×œ×™×œ ×’×“×•×œ.'
        },
        {
            sequence_number: 46,
            symbol_roman: ['IV', 'iii', 'vi', 'ii'],
            roots_intervals: [5, 4, 9, 2],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Minor],
            description_he: '××”×œ×š ×©×§×˜ ×•× ×™× ×•×—, ××ª×§×“× ×‘×©×œ×™×©×™×•×ª ×™×•×¨×“×•×ª.'
        },
        {
            sequence_number: 47,
            symbol_roman: ['IV^7', 'V7', 'I^7', 'vi7'],
            roots_intervals: [5, 7, 0, 9],
            chord_types: [chord_Major7, chord_Dominant7, chord_Major7, chord_Minor7],
            description_he: '×§×“× ×¦×” IV-V-I ×’×³××–×™×ª ×¢× ×©×™××•×© ×‘×“×¨×’×ª vi7 ×œ×™×¦×™×¨×ª ×œ×•×œ××” ×¨×¦×™×¤×”.'
        },
        {
            sequence_number: 48,
            symbol_roman: ['I', 'ii7', 'iii7', 'IV^7'],
            roots_intervals: [0, 2, 4, 5],
            chord_types: [chord_Major, chord_Minor7, chord_Minor7, chord_Major7],
            description_he: '××”×œ×š ×¢×•×œ×” ×©×œ× ×‘×“×¨×’×•×ª ×¨×¦×•×¤×•×ª, ××©×‘×™×¢×™×ª ××™× ×•×¨ ×œ×©×‘×™×¢×™×ª ××–×³×•×¨.'
        },
        {
            sequence_number: 49,
            symbol_roman: ['vi', 'viiÂ°', 'I', 'IV'],
            roots_intervals: [9, 11, 0, 5],
            chord_types: [chord_Minor, chord_Diminished, chord_Major, chord_Major],
            description_he: '××¢×‘×¨ ××ª×•×— ×-vi ×‘×××¦×¢×•×ª ×”×“×™××™× ×™×©×“ (viiÂ°) ×œ×™×¦×™×¨×ª ×¤×ª×¨×•×Ÿ ×—×–×§ ×œ×˜×•× ×™×§×”.'
        },
        {
            sequence_number: 50,
            symbol_roman: ['ii7', 'I/iii', 'IV^7', 'V7'],
            roots_intervals: [2, 4, 5, 7],
            chord_types: [chord_Minor7, chord_Major, chord_Major7, chord_Dominant7],
            description_he: '××”×œ×š ××•×¨×›×‘ ×”×›×•×œ×œ ××§×•×¨×“ ×—×™×œ×•×£ (Slash Chord) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×ª ×‘××¡ ×¨×¦×™×¤×”.'
        },
    ];

    // --- chord_progressions_min.js (××œ×) ---
    // ××¨×•×•×—×™ ×”×©×•×¨×©×™× (Roots) ×”×“×™××˜×•× ×™×™× ×‘×¡×•×œ× ××™× ×•×¨ ×˜×‘×¢×™: i=0, iiÂ°=2, III=3, iv=5, v=7, VI=8, VII=10
    // ×“×¨×’×•×ª ××•×©××œ×•×ª (Harmonic Minor): V=7 (Major), viiÂ°=11 (Diminished)
    const ALL_PROGRESSIONS_MINOR = [
        // === ×§×‘×•×¦×” 1: ×§×œ (×”×›×™ × ×¤×•×¥, ××©×•×œ×©×™× ×‘×œ×‘×“) ===
        {
            sequence_number: 1,
            symbol_roman: ['i', 'iv', 'v', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Minor],
            description_he: '××”×œ×š ×”××™× ×•×¨ ×”×˜×‘×¢×™ ×”×‘×¡×™×¡×™ ×‘×™×•×ª×¨, ×‘×¢×œ ×ª×—×•×©×” × ×•×’×” ×•××œ× ×›×•×œ×™×ª.'
        },
        {
            sequence_number: 2,
            symbol_roman: ['i', 'VI', 'VII', 'i'],
            roots_intervals: [0, 8, 10, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Minor],
            description_he: '××”×œ×š × ×¤×•×¥ ×‘×¨×•×§ ×•×‘××•×–×™×§×” ×¢×××™×ª, ×™×•×¦×¨ ×ª× ×•×¢×” ×—×œ×§×” ×›×œ×¤×™ ××¢×œ×” ×•××—×•×¨×”.'
        },
        {
            sequence_number: 3,
            symbol_roman: ['i', 'iv', 'VII', 'III'],
            roots_intervals: [0, 5, 10, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×©×§×˜ ×•××œ×•×“×™, ×¢×•×‘×¨ ×‘×™×Ÿ ×“×¨×’×•×ª ××™× ×•×¨×™×•×ª ×œ××–×³×•×¨×™×•×ª.'
        },
        {
            sequence_number: 4,
            symbol_roman: ['i', 'v', 'VI', 'III'],
            roots_intervals: [0, 7, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¨×’×•×¢, ××©×ª××© ×‘-v ×•×‘-VI ×›×“×™ ×œ×”×’×™×¢ ×œ×˜×•× ×™×§×” ×”×™×—×¡×™×ª (III).'
        },
        {
            sequence_number: 5,
            symbol_roman: ['i', 'VI', 'III', 'VII'],
            roots_intervals: [0, 8, 3, 10],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×”××©×ª××© ×‘×“×¨×’×” III ×›×˜×•× ×™×§×” ×™×—×¡×™×ª.'
        },
        {
            sequence_number: 6,
            symbol_roman: ['i', 'iv', 'VI', 'III'],
            roots_intervals: [0, 5, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '×¨×¦×£ ×—×œ×§ ×”××•×‘×™×œ ××“×¨×’×” iv ×œ×“×¨×’×” ×”×™×—×¡×™×ª III.'
        },
        {
            sequence_number: 7,
            symbol_roman: ['i', 'VII', 'VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¤×•×¤×•×œ×¨×™ ×‘××•×–×™×§×ª ××˜××œ/×¨×•×§ ×”××©×ª××© ×‘×“×¨×’×•×ª VII-VI-V.'
        },
        {
            sequence_number: 8,
            symbol_roman: ['iv', 'VII', 'III', 'VI'],
            roots_intervals: [5, 10, 3, 8],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ××—×–×•×¨×™ (loop) ×©×œ ×“×¨×’×•×ª ××–×³×•×¨×™×•×ª ×‘×ª×•×š ×¡×•×œ× ××™× ×•×¨×™.'
        },
        {
            sequence_number: 9,
            symbol_roman: ['i', 'III', 'VII', 'IV'],
            roots_intervals: [0, 3, 10, 5],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ××§×•×¨×“×™× ×”××“×’×™×© ××ª ×”×“×¨×’×” IV ×”××–×³×•×¨×™×ª.'
        },
        {
            sequence_number: 10,
            symbol_roman: ['iiÂ°', 'V', 'i'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_Diminished, chord_Major, chord_Minor],
            description_he: '×§×“× ×¦×” ××™× ×•×¨×™×ª ×—×–×§×” (iiÂ° - V - i) ×‘×××¦×¢×•×ª ×”×“×•××™× × ×˜ ×”××–×³×•×¨×™ (××”×¨××•× ×™ ××™× ×•×¨).'
        },
        // === ×§×‘×•×¦×” 2: ×‘×™× ×•× ×™ (×©×‘×™×¢×™×•×ª ×•×“×•××™× × ×˜×™× ××©× ×™×™×) ===
        {
            sequence_number: 11,
            symbol_roman: ['i', 'V7', 'i'],
            roots_intervals: [0, 7, 0],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor],
            description_he: '×§×“× ×¦×” ××™× ×•×¨×™×ª ××•×©×œ××ª ×•×—×–×§×” ×‘×××¦×¢×•×ª V7.'
        },
        {
            sequence_number: 12,
            symbol_roman: ['i', 'VImaj7', 'iiÃ¸7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Minor, chord_Major7, chord_HalfDiminished, chord_Dominant7],
            description_he: '×§×“× ×¦×” ii-V-i ×’×³××–×™×ª ×‘××™× ×•×¨, ××•×“×¨× ×™×ª ×•×¦×‘×¢×•× ×™×ª.'
        },
        {
            sequence_number: 13,
            symbol_roman: ['i', 'iv', 'v7', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Minor7, chord_Minor],
            description_he: '××”×œ×š ×”××©×ª××© ×‘×“×¨×’×” v7 (××™× ×•×¨ 7) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×” ×¨×›×” ×™×•×ª×¨.'
        },
        {
            sequence_number: 14,
            symbol_roman: ['III^7', 'VI^7', 'iiÃ¸7', 'V7'],
            roots_intervals: [3, 8, 2, 7],
            chord_types: [chord_Major7, chord_Major7, chord_HalfDiminished, chord_Dominant7],
            description_he: '××¢×’×œ ×§×•×•×™× ×˜×•×ª ×—×œ×§×™ ×”××ª×—×™×œ ×‘×˜×•× ×™×§×” ×”×™×—×¡×™×ª, × ×¤×•×¥ ×‘×‘×•×¡×” × ×•×‘×”.'
        },
        {
            sequence_number: 15,
            symbol_roman: ['i', 'IV7/i', 'iv', 'V7'],
            roots_intervals: [0, 5, 5, 7],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: '×©×™××•×© ×‘-IV7 ×›×“×•××™× × ×˜ ××©× ×™ ×”××•×©××œ (IV7) ×œ×™×¦×™×¨×ª ×¦×‘×¢ ×‘×œ×•×–×™.'
        },
        {
            sequence_number: 16,
            symbol_roman: ['iiÃ¸7', 'V7', 'i'],
            roots_intervals: [2, 7, 0],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Minor],
            description_he: '×§×“× ×¦×ª iiÃ¸7-V7-i, ×’×¨×¡×ª ×”××™× ×•×¨ ×”×§×œ××¡×™×ª ×œ-ii-V-I.'
        },
        {
            sequence_number: 17,
            symbol_roman: ['i', 'IV/i', 'iv', 'i'],
            roots_intervals: [0, 5, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Minor, chord_Minor],
            description_he: '××¢×‘×¨ ×¤×œ××’×œ×™ (iv-i) ×©×× ×•×§×“ ×‘××§×•×¨×“ IV ××–×³×•×¨ ××•×©××œ (IV/i).'
        },
        {
            sequence_number: 18,
            symbol_roman: ['i', 'i/VII', 'i/VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Major],
            description_he: '××”×œ×š ×™×•×¨×“ (Descending) ×¢× ×—×™×œ×•×¤×™ ×‘×¡, ×“×¨××˜×™ ×××•×“.'
        },
        {
            sequence_number: 19,
            symbol_roman: ['i', 'v', 'VI', 'V'],
            roots_intervals: [0, 7, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×”×™×•×¦×¨ ××ª×— ×¢×œ ×”×“×¨×’×” V ×”××–×³×•×¨×™×ª ×œ×¤× ×™ ×—×–×¨×” ×œ-i.'
        },
        {
            sequence_number: 20,
            symbol_roman: ['VII', 'i', 'iv', 'VII'],
            roots_intervals: [10, 0, 5, 10],
            chord_types: [chord_Major, chord_Minor, chord_Minor, chord_Major],
            description_he: '××”×œ×š ×¨×•×§ ×¨×¤×˜×˜×™×‘×™ ×”××ª×—×™×œ ×‘×“×¨×’×” ×”×©×‘×™×¢×™×ª.'
        },
        // === ×§×‘×•×¦×” 3: ××ª×§×“× (×”×¨××•× ×™, ××œ×•×“×™, ×“×™××™× ×™×©×“) ===
        {
            sequence_number: 21,
            symbol_roman: ['i', 'v(aug)', 'VI', 'IV'],
            roots_intervals: [0, 7, 8, 5],
            chord_types: [chord_Minor, chord_Augmented, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘-v ××•×’×“×œ (××”×¨××•× ×™ ××™× ×•×¨) ×œ×™×¦×™×¨×ª ×¦×œ×™×œ ××–×¨×—×™.'
        },
        {
            sequence_number: 22,
            symbol_roman: ['i', 'iv', 'V7', 'i'],
            roots_intervals: [0, 5, 7, 0],
            chord_types: [chord_Minor, chord_Minor, chord_Dominant7, chord_Minor],
            description_he: '×§×“× ×¦×” ××œ××” ×‘××™× ×•×¨ ×”×¨××•× ×™ (i-iv-V7-i).'
        },
        {
            sequence_number: 23,
            symbol_roman: ['iiÃ¸7', 'V7/III', 'III^7'],
            roots_intervals: [2, 10, 3],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Major7],
            description_he: '×§×“× ×¦×” ii-V-I ×©××•×‘×™×œ×” ×œ×˜×•× ×™×§×” ×”×™×—×¡×™×ª (III) ×‘×××¦×¢×•×ª ×“×•××™× × ×˜ ××©× ×™.'
        },
        {
            sequence_number: 24,
            symbol_roman: ['i', 'viiÂ°7', 'i'],
            roots_intervals: [0, 11, 0],
            chord_types: [chord_Minor, chord_Diminished, chord_Minor],
            description_he: '×©×™××•×© ×‘-viiÂ°7 (×“×™××™× ×™×©×“) ×‘×ª×•×š ×¡×•×œ× ××™× ×•×¨×™, ×™×•×¦×¨ ××ª×— ×“×¨××˜×™ ×—×–×§.'
        },
        {
            sequence_number: 25,
            symbol_roman: ['i', 'VI', 'III', 'iiÃ¸7'],
            roots_intervals: [0, 8, 3, 2],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_HalfDiminished],
            description_he: '××”×œ×š ×™×¦×™×‘ ×”××›×™×Ÿ ×œ-iiÃ¸7 ××ª×•×— ×œ×¤× ×™ ×—×–×¨×” ××¤×©×¨×™×ª ×œ-V7.'
        },
        {
            sequence_number: 26,
            symbol_roman: ['i', 'V7/iv', 'iv', 'V7'],
            roots_intervals: [0, 9, 5, 7],
            chord_types: [chord_Minor, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ××©× ×™ (V7 ×©×œ iv) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×” ×—×–×§×” ×œ×“×¨×’×” iv.'
        },
        {
            sequence_number: 27,
            symbol_roman: ['i', 'iv', 'V7', 'VI'],
            roots_intervals: [0, 5, 7, 8],
            chord_types: [chord_Minor, chord_Minor, chord_Dominant7, chord_Major],
            description_he: '×§×“× ×¦×” ×”×˜×¢×™×” (Deceptive Cadence) ×œ-VI ×‘××§×•× ×œ-i.'
        },
        {
            sequence_number: 28,
            symbol_roman: ['iv', 'i/III', 'VI', 'V'],
            roots_intervals: [5, 3, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '×—×™×œ×•×£ ×‘×¡ ××ª×•×— ×œ-III ××–×³×•×¨ ×œ×¤× ×™ ××¢×‘×¨ ×œ-VI.'
        },
        {
            sequence_number: 29,
            symbol_roman: ['iiÃ¸7', 'III^7', 'V7', 'i'],
            roots_intervals: [2, 3, 7, 0],
            chord_types: [chord_HalfDiminished, chord_Major7, chord_Dominant7, chord_Minor],
            description_he: '×¨×¦×£ ××•×“×¨× ×™ ×”××©×ª××© ×‘-III^7 ×›×“×™ ×œ×¢×‘×•×¨ ×‘×¦×•×¨×” ×—×œ×§×” ×œ×§×“× ×¦×” V7.'
        },
        {
            sequence_number: 30,
            symbol_roman: ['i', 'iv', 'i/V', 'V7'],
            roots_intervals: [0, 5, 7, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Minor, chord_Dominant7],
            description_he: '×”×§×“× ×¦×” i-iv ×¢× ×‘×¡ V ×©××—×–×§×ª ××ª ×”-V7 ×”×“×•××™× × ×˜×™.'
        },
        // === ×§×‘×•×¦×” 4: ××•×“×¨× ×™ (×¤×•×¤/R&B ××™× ×•×¨×™) ===
        {
            sequence_number: 31,
            symbol_roman: ['i', 'bVII', 'bVI', 'i'],
            roots_intervals: [0, 10, 8, 0],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Minor],
            description_he: '××”×œ×š ××•×¤×™×™× ×™ ×œ-R&B ×•×¤×•×¤ ××•×“×¨× ×™, ×¢× ×“×¨×’×•×ª ××•×©××œ×•×ª (bVII, bVI).'
        },
        {
            sequence_number: 32,
            symbol_roman: ['iv', 'bVII', 'III', 'VI'],
            roots_intervals: [5, 10, 3, 8],
            chord_types: [chord_Minor, chord_Major, chord_Major, chord_Major],
            description_he: '××”×œ×š ××—×–×•×¨×™ ×©×œ ××§×•×¨×“×™× ××–×³×•×¨×™×™× ×•××™× ×•×¨×™×™× ×”××ª×§×“× ×‘×¨×‘×™×¢×™×•×ª/×§×•×•×™× ×˜×•×ª.'
        },
        {
            sequence_number: 33,
            symbol_roman: ['i', 'v', 'VI', 'VII'],
            roots_intervals: [0, 7, 8, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×©×™×›×•×œ ×œ×”×ª××™× ×œ××•×–×™×§×” ×§×œ××¡×™×ª ××• ×¤×•×œ×§.'
        },
        {
            sequence_number: 34,
            symbol_roman: ['i', 'III^7', 'VI^7', 'iiÃ¸7'],
            roots_intervals: [0, 3, 8, 2],
            chord_types: [chord_Minor, chord_Major7, chord_Major7, chord_HalfDiminished],
            description_he: '×¨×¦×£ ×©×‘×™×¢×™×•×ª ×’×³××–×™ ×‘××™× ×•×¨.'
        },
        {
            sequence_number: 35,
            symbol_roman: ['i', 'VII', 'iv', 'i'],
            roots_intervals: [0, 10, 5, 0],
            chord_types: [chord_Minor, chord_Major, chord_Minor, chord_Minor],
            description_he: '××”×œ×š ×‘×¡×™×¡×™ ×•×§×œ ×¢× ×ª× ×•×¢×” ×¤×©×•×˜×”.'
        },
        {
            sequence_number: 36,
            symbol_roman: ['v', 'i', 'III', 'VII'],
            roots_intervals: [7, 0, 3, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×©××ª×—×™×œ ×‘×“×¨×’×” v ×•×™×•×¦×¨ ×ª×—×•×©×ª ×ª× ×•×¢×” ×—×–×§×” ×œ×˜×•× ×™×§×”.'
        },
        {
            sequence_number: 37,
            symbol_roman: ['i', 'i/VII', 'VI', 'V'],
            roots_intervals: [0, 10, 8, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '×©×™××•×© ×‘×‘×¡ ×™×•×¨×“ ×›×¨×•××˜×™ (i, i/VII, VI) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×” ×“×¨××˜×™×ª.'
        },
        {
            sequence_number: 38,
            symbol_roman: ['III^7', 'VII7', 'i7'],
            roots_intervals: [3, 10, 0],
            chord_types: [chord_Major7, chord_Dominant7, chord_Minor7],
            description_he: '×§×“× ×¦×” ×’×³××–×™×ª ×¢× ××§×•×¨×“ ××•×—×œ×£ VII7 ×©××•×‘×™×œ ×œ×˜×•× ×™×§×” ××™× ×•×¨×™×ª.'
        },
        {
            sequence_number: 39,
            symbol_roman: ['i', 'iiÃ¸7', 'III^7', 'iv7'],
            roots_intervals: [0, 2, 3, 5],
            chord_types: [chord_Minor, chord_HalfDiminished, chord_Major7, chord_Minor7],
            description_he: '××”×œ×š ×¢×•×œ×” ×©××•×‘×™×œ ×-i ×œ-iv7 ×‘×××¦×¢×•×ª ××§×•×¨×“×™× ××ª×•×—×™×.'
        },
        {
            sequence_number: 40,
            symbol_roman: ['i', 'v', 'VI', 'III'],
            roots_intervals: [0, 7, 8, 3],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ×¨×š ×”××©×ª××© ×‘-III ×›×˜×•× ×™×§×” ×™×—×¡×™×ª ×–×× ×™×ª.'
        },
        // === ×§×‘×•×¦×” 5: ×’'××– ×•×¤×™×•×–'×Ÿ ××™× ×•×¨×™ ===
        {
            sequence_number: 41,
            symbol_roman: ['i7', 'iv7', 'VII7', 'III^7'],
            roots_intervals: [0, 5, 10, 3],
            chord_types: [chord_Minor7, chord_Minor7, chord_Dominant7, chord_Major7],
            description_he: '×¨×¦×£ ×©×‘×™×¢×™×•×ª ××—×–×•×¨×™, × ×¤×•×¥ ×‘×¡×’× ×•× ×•×ª ×œ×˜×™× ×™×™× ×•×’×³××– ××™× ×•×¨×™.'
        },
        {
            sequence_number: 42,
            symbol_roman: ['iiÃ¸7', 'V7', 'i', 'V7/III'],
            roots_intervals: [2, 7, 0, 10],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Minor, chord_Dominant7],
            description_he: '×©×™××•×© ×‘×“×•××™× × ×˜ ××©× ×™ (V7 ×©×œ III) ×›×”×›× ×” ×œ×˜×•× ×™×§×” ×”×™×—×¡×™×ª.'
        },
        {
            sequence_number: 43,
            symbol_roman: ['i', 'VI', 'II7', 'V7'],
            roots_intervals: [0, 8, 2, 7],
            chord_types: [chord_Minor, chord_Major, chord_Dominant7, chord_Dominant7],
            description_he: '×©×™××•×© ×‘-II7 (×“×•××™× × ×˜ ××©× ×™ ×©×œ V) ×œ×™×¦×™×¨×ª ××ª×— ×—×–×§ ×œ×¤× ×™ ×”-V7.'
        },
        {
            sequence_number: 44,
            symbol_roman: ['i', 'i(aug)', 'iv', 'VII'],
            roots_intervals: [0, 0, 5, 10],
            chord_types: [chord_Minor, chord_Augmented, chord_Minor, chord_Major],
            description_he: '××¢×‘×¨ ×›×¨×•××˜×™ ×¢×œ ×”×˜×•× ×™×§×” (i ×œ-iAug) ×›×“×™ ×œ×™×¦×•×¨ ×ª× ×•×¢×” ×—×“×” ×œ-iv.'
        },
        {
            sequence_number: 45,
            symbol_roman: ['III^7', 'i7', 'VI^7', 'iv7'],
            roots_intervals: [3, 0, 8, 5],
            chord_types: [chord_Major7, chord_Minor7, chord_Major7, chord_Minor7],
            description_he: '××”×œ×š ×¢×’×•×œ ×¢× ×©×‘×™×¢×™×•×ª ××–×³×•×¨ ×•××™× ×•×¨, × ×©××¢ × ×™× ×•×— ×•××œ×•×“×™.'
        },
        {
            sequence_number: 46,
            symbol_roman: ['i', 'iiÃ¸7', 'III^7', 'V7'],
            roots_intervals: [0, 2, 3, 7],
            chord_types: [chord_Minor, chord_HalfDiminished, chord_Major7, chord_Dominant7],
            description_he: '×¨×¦×£ ×”×¨××•× ×™ ××¢× ×™×™×Ÿ ×”××©×œ×‘ ×¡×•×’×™ ××§×•×¨×“×™× ×©×•× ×™× ×œ×§×¨××ª ×§×“× ×¦×”.'
        },
        {
            sequence_number: 47,
            symbol_roman: ['i', 'v7', 'iiÃ¸7', 'V7'],
            roots_intervals: [0, 7, 2, 7],
            chord_types: [chord_Minor, chord_Minor7, chord_HalfDiminished, chord_Dominant7],
            description_he: '×©×™××•×© ×‘-v7 ×›×”×§×“××” ×œ-iiÃ¸7-V7, ×™×•×¦×¨ ××¢×’×œ ×§×•×•×™× ×˜×•×ª ×¨×—×‘.'
        },
        {
            sequence_number: 48,
            symbol_roman: ['i', 'iv', 'VI/bVII', 'VII'],
            roots_intervals: [0, 5, 10, 10],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ××•×“×¨× ×™ ×”××©×ª××© ×‘××§×•×¨×“ ×—×™×œ×•×£ (Slash Chord) ×œ×™×¦×™×¨×ª ×ª× ×•×¢×ª ×‘×¡ ××¢× ×™×™× ×ª.'
        },
        {
            sequence_number: 49,
            symbol_roman: ['iiÃ¸7', 'VII7/III', 'III^7'],
            roots_intervals: [2, 11, 3],
            chord_types: [chord_HalfDiminished, chord_Dominant7, chord_Major7],
            description_he: '×©×™××•×© ×‘-VII7 ×©×œ III ×›×›×¨×•××˜×™×–× ×œ×™×¦×™×¨×ª ××¢×‘×¨ ×—×œ×§ ×œ-III^7.'
        },
        {
            sequence_number: 50,
            symbol_roman: ['i', 'iv', 'VII', 'V'],
            roots_intervals: [0, 5, 10, 7],
            chord_types: [chord_Minor, chord_Minor, chord_Major, chord_Major],
            description_he: '××”×œ×š ××™× ×•×¨×™ ×™×¦×™×‘ ×•××ª×•×—, × ×¤×•×¥ ×‘××•×–×™×§×” ×§×œ××¡×™×ª ×•×‘×ª-×–×× × ×•.'
        },
    ];

    // =========================================================================================
    // 3. ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×•××¦×‘ ×”××¤×œ×™×§×¦×™×” + ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
    // =========================================================================================
    let selectedRoot = null; // C, D, E, F, G, A, B
    let selectedAccidental = 'none'; // sharp, flat, none
    let selectedQuality = 'major'; // major, minor
    let currentProgressionIndex = 0;
    let progressionData = ALL_PROGRESSIONS_MAJOR; // ×™×˜×¢×Ÿ ××ª ×”××¢×¨×š ×”×¨×œ×•×•× ×˜×™

    // ××©×ª× ×™ MIDI
    let isMidiMode = false;
    let midiAccess = null;
    let currentStepIndex = 0; // ××™×–×” ××§×•×¨×“ ×‘××”×œ×š ×× ×—× ×• ×× ×’× ×™× ×›×¨×’×¢
    let currentProgressionTargets = []; // ×™×—×–×™×§ ××ª ×”×ª×•×•×™× (××¡×¤×¨×™× 0-11) ×©×œ ×›×œ ××§×•×¨×“ ×‘××”×œ×š ×”× ×•×›×—×™
    let notesPlayedInCurrentStep = new Set(); // ××œ×• ×ª×•×•×™× ×›×‘×¨ × ×•×’× ×• ×‘××§×•×¨×“ ×”× ×•×›×—×™
    let previousChordNotes = []; // ×ª×•×•×™× ××”××§×•×¨×“ ×”×§×•×“× (×œ×× ×™×¢×ª ×©×’×™××•×ª ××¢×‘×¨)
    let lastChordFinishTime = 0; // ××ª×™ ×¡×™×™×× ×• ××ª ×”××§×•×¨×“ ×”×§×•×“×
    let isInputBlocked = false; // ×œ×—×¡×™××ª ×§×œ×˜ ×‘×–××Ÿ ××¢×‘×¨ ×‘×™×Ÿ ××”×œ×›×™×

    function findNoteByDistance(halfToneDistance) {
        const normalizedDistance = (halfToneDistance % 12 + 12) % 12;
        return ALL_NOTES_ARRAY[normalizedDistance];
    }

    // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª ×¡×•×œ× ×¢× ×›×ª×™×‘ × ×›×•×Ÿ (×“×™××–/×‘××•×œ)
    function getScaleNotes(rootNote, scaleObject, accidentalPreference) {
        const notes = [];
        const rootDistance = rootNote.half_tone_distance;

        let isFlatPreference = accidentalPreference === 'flat';
        if (accidentalPreference === 'none') {
            // ×”×›×œ×œ ×”×¤×©×•×˜: ×× ×”×©×•×¨×© ×”×•× F, ×™×© ×‘××•×œ. ×× ×”×©×•×¨×© ×”×•× B ×‘×¡×•×œ× ××™× ×•×¨, ×™×© ×‘××•×œ.
            isFlatPreference = (rootNote.name_en_primary === 'F' && scaleObject === scale_Major) || 
                                (rootNote.name_en_primary === 'B' && scaleObject === scale_Minor);
        }
        
        for (const interval of scaleObject.intervals) {
            const currentDistance = (rootDistance + interval) % 12;
            const noteObj = findNoteByDistance(currentDistance);

            const displayedNote = { distance: currentDistance, name_en: '', name_he: '' };

            if (currentDistance === 0 || currentDistance === 2 || currentDistance === 4 || currentDistance === 5 || currentDistance === 7 || currentDistance === 9 || currentDistance === 11) {
                // ×ª×• ×˜×‘×¢×™
                displayedNote.name_en = noteObj.name_en_primary;
                displayedNote.name_he = noteObj.name_he_primary;
            } else {
                // ×ª×• ×©×—×•×¨ (×“×™××–/×‘××•×œ)
                if (isFlatPreference) {
                    displayedNote.name_en = noteObj.name_en_alternate;
                    displayedNote.name_he = noteObj.name_he_alternate;
                } else {
                    displayedNote.name_en = noteObj.name_en_primary;
                    displayedNote.name_he = noteObj.name_he_primary;
                }
            }
            notes.push(displayedNote);
        }
        return notes;
    }

    // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª ××§×•×¨×“
    function getChordNotes(rootNote, chordType) {
        const notes = [];
        const rootDistance = rootNote.half_tone_distance;
        
        // ×§×‘×™×¢×ª ×”×¢×“×¤×ª ×›×ª×™×‘ ×¤×©×•×˜×”: ×× ×”×©×•×¨×© ×”×•× ×‘××•×œ ××• ×“×™××–, × ×©×ª××© ×‘×–×”.
        const isFlatPreference = rootNote.name_en_alternate !== rootNote.name_en_primary && rootNote.name_en_alternate.includes('â™­');

        for (const interval of chordType.intervals) {
            const currentDistance = (rootDistance + interval) % 12;
            const noteObj = findNoteByDistance(currentDistance);
            
            const noteData = {};
            if (noteObj.name_en_primary === noteObj.name_en_alternate) {
                noteData.name_en = noteObj.name_en_primary;
                noteData.name_he = noteObj.name_he_primary;
            } else {
                if (isFlatPreference) {
                    noteData.name_en = noteObj.name_en_alternate;
                    noteData.name_he = noteObj.name_he_alternate;
                } else {
                    noteData.name_en = noteObj.name_en_primary;
                    noteData.name_he = noteObj.name_he_primary;
                }
            }
            notes.push(noteData);
        }
        return notes;
    }

    function switchScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.style.display = 'none';
        });
        document.getElementById(screenId).style.display = 'block';
    }

    // =========================================================================================
    // 4. ×œ×•×’×™×§×ª ××¡×š ×”×‘×™×ª (×‘×—×™×¨×ª ×¡×•×œ×)
    // =========================================================================================

    function updateSelection(type, value) {
        if (type === 'note') selectedRoot = value;
        if (type === 'accidental') selectedAccidental = value;
        if (type === 'quality') selectedQuality = value;

        document.querySelectorAll(`.${type}-buttons button`).forEach(btn => {
            btn.classList.remove('selected');
        });
        const selector = type === 'note' ? `[data-note="${value}"]` :
                         type === 'accidental' ? `[data-accidental="${value}"]` :
                         `[data-quality="${value}"]`;
        document.querySelector(selector).classList.add('selected');

        validateSelectionAndEnableButtons();
    }

    function validateSelectionAndEnableButtons() {
        const isValid = selectedRoot !== null;
        document.getElementById('practice-scale-btn').disabled = !isValid;
        document.getElementById('practice-chords-btn').disabled = !isValid;
        document.getElementById('practice-midi-btn').disabled = !isValid; // <--- ×”×•×¡×£ ×©×•×¨×” ×–×•
    }

    function selectRandomScale() {
        const rootNotes = Object.keys(BASE_NOTE_DISTANCES);
        updateSelection('note', rootNotes[Math.floor(Math.random() * rootNotes.length)]);
        
        const accidentals = ['none', 'sharp', 'flat'];
        updateSelection('accidental', accidentals[Math.floor(Math.random() * accidentals.length)]);
        
        const qualities = ['major', 'minor'];
        updateSelection('quality', qualities[Math.floor(Math.random() * qualities.length)]);
    }
    
    // ×”×’×“×¨×ª ×××–×™× ×™× ×œ×›×¤×ª×•×¨×™ ×”×‘×—×™×¨×”
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.note-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('note', e.target.dataset.note));
        });
        document.querySelectorAll('.accidental-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('accidental', e.target.dataset.accidental));
        });
        document.querySelectorAll('.quality-buttons button').forEach(btn => {
            btn.addEventListener('click', (e) => updateSelection('quality', e.target.dataset.quality));
        });
        
        // ×‘×—×™×¨×ª ×‘×¨×™×¨×ª ××—×“×œ
        if (selectedRoot === null) {
            updateSelection('note', 'C');
        }
        validateSelectionAndEnableButtons();
    });

    // =========================================================================================
    // 5. ×œ×•×’×™×§×ª ×ª×¨×’×•×œ ×¡×•×œ×
    // =========================================================================================

    function startScalePractice() {
        const rootDistance = BASE_NOTE_DISTANCES[selectedRoot];
        let finalDistance = rootDistance;
        let accidentalSymbol = '';

        if (selectedAccidental === 'sharp') {
            finalDistance = (rootDistance + 1) % 12;
            accidentalSymbol = 'â™¯';
        } else if (selectedAccidental === 'flat') {
            finalDistance = (rootDistance - 1 + 12) % 12;
            accidentalSymbol = 'â™­';
        }

        const rootNoteObject = findNoteByDistance(finalDistance);
        
        // ×‘× ×™×™×ª ×©× ×”×¡×•×œ×
        let displayedRootName = selectedRoot;
        if (selectedAccidental === 'sharp') displayedRootName += 'â™¯';
        if (selectedAccidental === 'flat') displayedRootName += 'â™­';

        const scaleName = `${displayedRootName} ${selectedQuality === 'major' ? scale_Major.name_he : scale_Minor.name_he}`;
        document.getElementById('scale-title').textContent = scaleName;

        const scaleObject = selectedQuality === 'major' ? scale_Major : scale_Minor;
        
        // 1. ×ª×¦×•×’×ª ××¨×•×•×—×™× ×‘×™×Ÿ ×ª×• ×œ×ª×•
        const intervalsContainer = document.getElementById('scale-intervals-container');
        intervalsContainer.innerHTML = '';
        scaleObject.step_intervals_he.forEach((interval) => {
            const intervalEl = document.createElement('div');
            intervalEl.className = 'interval-item';
            intervalEl.textContent = interval;
            intervalsContainer.appendChild(intervalEl);
        });

        // 2. ××™×¤×•×¡ ×•×©××™×¨×ª × ×ª×•× ×™× ×œ×ª×¦×•×’×ª ×”×ª×•×•×™×
        const notesContainer = document.getElementById('scale-notes-container');
        notesContainer.innerHTML = '';
        notesContainer.dataset.rootDistance = rootNoteObject.half_tone_distance;
        notesContainer.dataset.accidentalPreference = selectedAccidental;
        notesContainer.dataset.quality = selectedQuality;
        
        document.getElementById('notes-label').style.display = 'none';

        switchScreen('scale-practice-screen');
    }

    function showScaleNotes() {
        const notesContainer = document.getElementById('scale-notes-container');
        
        if (notesContainer.innerHTML !== '') return; // ×× ×”×ª×•×•×™× ×›×‘×¨ ××•×¦×’×™×
        
        const rootDistance = parseInt(notesContainer.dataset.rootDistance);
        const accidentalPreference = notesContainer.dataset.accidentalPreference;
        const quality = notesContainer.dataset.quality;

        const scaleObject = quality === 'major' ? scale_Major : scale_Minor;
        const rootNoteObject = findNoteByDistance(rootDistance);

        const notes = getScaleNotes(rootNoteObject, scaleObject, accidentalPreference);

        notes.forEach(note => {
            const noteEl = document.createElement('div');
            noteEl.className = 'result-item';
            noteEl.innerHTML = `
                ${note.name_en}
                <span class="hebrew-name">${note.name_he}</span>
            `;
            notesContainer.appendChild(noteEl);
        });

        document.getElementById('notes-label').style.display = 'block';
    }


    // =========================================================================================
    // 6. ×œ×•×’×™×§×ª ×ª×¨×’×•×œ ××”×œ×›×™ ××§×•×¨×“×™× + MIDI Logic
    // =========================================================================================

    // ×¤×•× ×§×¦×™×” ×©××ª×—×™×œ×” ××ª ×”×ª×¨×’×•×œ ×‘××¦×‘ MIDI
    function startMidiPractice() {
        if (!navigator.requestMIDIAccess) {
            alert("×”×“×¤×“×¤×Ÿ ×©×œ×š ×œ× ×ª×•××š ×‘-MIDI. ×× × × ×¡×” ×‘×›×¨×•× ××• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ××—×¨.");
            return;
        }

        navigator.requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);

        function onMIDISuccess(access) {
            midiAccess = access;
            const inputs = midiAccess.inputs.values();
            for (let input of inputs) {
                input.onmidimessage = handleMidiMessage;
            }
            
            isMidiMode = true;
            startChordPractice(); // ××©×ª××©×™× ×‘××•×ª×” ×œ×•×’×™×§×ª ×ª×¦×•×’×”, ××‘×œ ×”×“×’×œ×™× ×”×©×ª× ×•
        }

        function onMIDIFailure() {
            alert("×œ× ×”×¦×œ×—×ª×™ ×œ×’×©×ª ×œ×”×ª×§×Ÿ MIDI.");
        }
    }

    // ×”×œ×™×‘×”: ×˜×™×¤×•×œ ×‘×”×•×“×¢×•×ª MIDI
    function handleMidiMessage(event) {
        // ×× ×× ×—× ×• ×œ× ×‘××¦×‘ MIDI, ××• ×©×”×§×œ×˜ ×—×¡×•× (×‘×™×Ÿ ×ª×¨×’×™×œ×™×), ××• ×©×–×” ×©×œ×‘ "×”×›×¨ ××ª ×”×¡×•×œ×" (-1)
        if (!isMidiMode || isInputBlocked || currentProgressionIndex === -1) return;

        const command = event.data[0];
        const noteRaw = event.data[1];
        const velocity = (event.data.length > 2) ? event.data[2] : 0;

        // ×”×ª×™×™×—×¡×•×ª ×¨×§ ×œ-Note On (×§×•×“ 144) ×•×¨×§ ×× ×”×¢×•×¦××” ×’×“×•×œ×” ×-0
        if (command === 144 && velocity > 0) {
            const normalizedNote = noteRaw % 12; // × ×™×¨××•×œ ×œ××•×§×˜×‘×” ××—×ª (0-11)
            checkNoteLogic(normalizedNote);
        }
    }

    function checkNoteLogic(note) {
        // ×§×‘×œ×ª ×ª×•×•×™ ×”××˜×¨×” ×©×œ ×”××§×•×¨×“ ×”× ×•×›×—×™
        const targetNotes = currentProgressionTargets[currentStepIndex]; 
        if (!targetNotes) return;

        // 1. ×”×× ×”×ª×• ×”×× ×•×’×Ÿ ×”×•× ×—×œ×§ ××”××§×•×¨×“ ×”× ×•×›×—×™?
        if (targetNotes.includes(note)) {
            notesPlayedInCurrentStep.add(note);
            
            // ×‘×“×™×§×” ×× ×”×©×œ×× ×• ××ª ×›×œ ×”×ª×•×•×™× ×‘××§×•×¨×“
            if (notesPlayedInCurrentStep.size === targetNotes.length) {
                advanceToNextChord();
            }
        } 
        // 2. ×”×ª×• ×œ× × ×›×•×Ÿ. ×”×× ××•×ª×¨ ×œ× ×’×Ÿ ××•×ª×•? (×—×•×§ ×”-5 ×©× ×™×•×ª ××”××§×•×¨×“ ×”×§×•×“×)
        else {
            const timeSinceLast = Date.now() - lastChordFinishTime;
            const isFromPrevChord = previousChordNotes.includes(note);

            if (isFromPrevChord && timeSinceLast < 5000) {
                // ×–×” ×ª×• ××”××§×•×¨×“ ×”×§×•×“× ×•×¢×‘×¨×• ×¤×—×•×ª ×-5 ×©× ×™×•×ª -> ×”×ª×¢×œ×
                console.log("Ignoring bleed note from previous chord");
                return;
            } else {
                // ×˜×¢×•×ª ×××™×ª×™×ª!
                handleMistake();
            }
        }
    }

    function advanceToNextChord() {
        // ×©××™×¨×ª ×”×™×¡×˜×•×¨×™×” ×œ×× ×™×¢×ª ×˜×¢×•×™×•×ª ×‘××¢×‘×¨
        previousChordNotes = currentProgressionTargets[currentStepIndex];
        lastChordFinishTime = Date.now();
        
        // ××™×¤×•×¡ ×¡×˜ ×”×ª×•×•×™× ×œ××§×•×¨×“ ×”×‘×
        notesPlayedInCurrentStep.clear();
        
        currentStepIndex++;

        // ×”×× ×¡×™×™×× ×• ××ª ×”××”×œ×š?
        if (currentStepIndex >= currentProgressionTargets.length) {
            handleProgressionComplete();
        } else {
            // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” (×”×–×–×ª ×”×”×“×’×©×”)
            updateHighlight();
        }
    }

    function handleMistake() {
        const toast = document.getElementById('error-toast');
        toast.classList.add('show');
        
        // ××™×¤×•×¡ ×œ×”×ª×—×œ×”
        currentStepIndex = 0;
        notesPlayedInCurrentStep.clear();
        updateHighlight(); // ××—×–×™×¨ ××ª ×”×”×“×’×©×” ×œ×”×ª×—×œ×”

        // ×”×¡×ª×¨×ª ×”×”×•×“×¢×” ××—×¨×™ 2 ×©× ×™×•×ª
        setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }

    function handleProgressionComplete() {
        isInputBlocked = true; // ×”×©×‘×ª×ª ×”××–× ×”
        
        // ×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£ ××¤×§×˜ ×•×™×–×•××œ×™ ×§×˜×Ÿ ×©×œ ×”×¦×œ×—×” ×× ×¨×•×¦×™×
        
        setTimeout(() => {
            changeProgression(1); // ××¢×‘×¨ ×œ××”×œ×š ×”×‘×
            isInputBlocked = false; // ×”×—×–×¨×ª ×”××–× ×” (×”×¤×•× ×§×¦×™×” displayCurrentProgression ×ª××¤×¡ ××ª ×”××“×“×™×)
        }, 5000);
    }

    // ×¤×•× ×§×¦×™×” ×•×™×–×•××œ×™×ª ×‘×œ×‘×“ - ××¢×‘×™×¨×” ××ª ×”-class 'current-target'
    function updateHighlight() {
        const steps = document.querySelectorAll('.progression-step');
        steps.forEach((step, index) => {
            if (index === currentStepIndex) {
                step.classList.add('current-target');
            } else {
                step.classList.remove('current-target');
            }
        });
    }


    function startChordPractice() {
        // ×‘×“×™×§×”: ×× ×”×¤×•× ×§×¦×™×” × ×§×¨××” ××”×›×¤×ª×•×¨ ×”×¨×’×™×œ ×•×œ× ××›×¤×ª×•×¨ ×”-MIDI, ×‘×˜×œ ××¦×‘ MIDI
        if (event && event.target.id === 'practice-chords-btn') {
            isMidiMode = false;
            if (midiAccess) {
                // ××•×¤×¦×™×•× ×œ×™: × ×™×ª×•×§ ×××–×™× ×™× ×× ×¨×•×¦×™× ×œ×”×™×•×ª ×™×¡×•×“×™×™×
                for (let input of midiAccess.inputs.values()) input.onmidimessage = null;
            }
        }

        progressionData = selectedQuality === 'major' ? ALL_PROGRESSIONS_MAJOR : ALL_PROGRESSIONS_MINOR;
        
        currentProgressionIndex = -1; 
        
        document.getElementById('toggle-chord-names').checked = false;
        
        displayCurrentProgression();
        switchScreen('progression-practice-screen');
    }

    function changeProgression(step) {
        const totalSteps = progressionData.length + 1; // +1 ×¢×‘×•×¨ ×©×œ×‘ "×”×›×¨ ××ª ×”×¡×•×œ×"
        let newIndex = currentProgressionIndex + step;

        if (newIndex < -1) {
            // ×× ×”×™×™× ×• ×‘-1- ×•×œ×—×¦× ×• "×§×•×“×", × ×¢×‘×•×¨ ×œ××”×œ×š ×”××—×¨×•×Ÿ
            newIndex = progressionData.length - 1;
        } else if (newIndex >= progressionData.length) {
            // ×× ×”×™×™× ×• ×‘××”×œ×š ×”××—×¨×•×Ÿ ×•×œ×—×¦× ×• "×”×‘×", × ×—×–×•×¨ ×œ-1-
            newIndex = -1;
        }

        currentProgressionIndex = newIndex;
        displayCurrentProgression();
    }

    function displayCurrentProgression() {
        if (progressionData.length === 0) return;

        // === ××™×¤×•×¡ ××©×ª× ×™ MIDI ×œ××”×œ×š ×”×—×“×© ===
        currentProgressionTargets = []; 
        currentStepIndex = 0;
        notesPlayedInCurrentStep.clear();
        previousChordNotes = []; // ××™×¤×•×¡ ×–×™×›×¨×•×Ÿ ××§×•×¨×“ ×§×•×“× ×‘××¢×‘×¨ ×œ×ª×¨×’×™×œ ×—×“×©
        // =================================

        const container = document.getElementById('current-progression-container');
        container.innerHTML = '';
        
        const rootDistance = BASE_NOTE_DISTANCES[selectedRoot];
        let finalDistance = rootDistance;
        
        if (selectedAccidental === 'sharp') {
            finalDistance = (rootDistance + 1) % 12;
        } else if (selectedAccidental === 'flat') {
            finalDistance = (rootDistance - 1 + 12) % 12;
        }
        
        let accidentalSymbol = '';
        if (selectedAccidental === 'sharp') accidentalSymbol = 'â™¯';
        if (selectedAccidental === 'flat') accidentalSymbol = 'â™­';

        const scaleName = `${selectedRoot}${accidentalSymbol} ${selectedQuality === 'major' ? scale_Major.name_he : scale_Minor.name_he}`;
        
        if (currentProgressionIndex === -1) {
            document.getElementById('progression-title').textContent = `×”×›×¨ ××ª ×”×¡×•×œ×: ${scaleName}`;
            document.getElementById('progression-description').textContent = '××œ×• ×”×Ÿ 7 ×“×¨×’×•×ª ×”×¡×•×œ× ×”×‘×¡×™×¡×™×•×ª ×©×¢×œ×™×”×Ÿ × ×‘× ×™× ×”××§×•×¨×“×™× (××¦×‘ MIDI ××™× ×• ×¤×¢×™×œ ×‘××¡×š ×–×”).';
            document.querySelector('.toggle-switch-container').style.display = 'none';

            let degrees, intervals, types;
            if (selectedQuality === 'major') {
                degrees = ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'viiÂ°'];
                intervals = [0, 2, 4, 5, 7, 9, 11];
                types = [chord_Major, chord_Minor, chord_Minor, chord_Major, chord_Major, chord_Minor, chord_Diminished];
            } else {
                degrees = ['i', 'iiÂ°', 'III', 'iv', 'v', 'VI', 'VII'];
                intervals = [0, 2, 3, 5, 7, 8, 10];
                types = [chord_Minor, chord_Diminished, chord_Major, chord_Minor, chord_Minor, chord_Major, chord_Major];
            }

            intervals.forEach((intervalFromRoot, index) => {
                const chordType = types[index];
                const romanSymbol = degrees[index];
                const chordRootDistance = (finalDistance + intervalFromRoot) % 12;
                const chordRootNote = findNoteByDistance(chordRootDistance);
                
                let chordRootNameEn = chordRootNote.name_en_primary;
                if (selectedAccidental === 'flat' && chordRootNote.name_en_alternate !== chordRootNote.name_en_primary) {
                    chordRootNameEn = chordRootNote.name_en_alternate;
                }
                const chordName = chordRootNameEn + chordType.symbol_suffix;

                const stepEl = document.createElement('div');
                stepEl.className = 'progression-step';
                stepEl.dataset.fullChordName = chordName;
                stepEl.onclick = () => openChordModal(chordRootNote, chordType, romanSymbol, chordName);

                stepEl.innerHTML = `<div class="roman-numeral">${romanSymbol}</div><div class="chord-name">${chordName}</div>`;
                container.appendChild(stepEl);
            });

        } else {
            document.querySelector('.toggle-switch-container').style.display = 'flex';
            const progression = progressionData[currentProgressionIndex];
            
            // ×”×•×¡×¤×ª ×—×™×•×•×™ ×‘×›×•×ª×¨×ª ×× ××¦×‘ MIDI ×¤×¢×™×œ
            const midiTitleSuffix = isMidiMode ? " (××¦×‘ MIDI ×¤×¢×™×œ ğŸ¹)" : "";
            document.getElementById('progression-title').textContent = `××”×œ×š ${progression.sequence_number} ××ª×•×š ${progressionData.length} ×‘×¡×•×œ× ${scaleName}${midiTitleSuffix}`;
            
            document.getElementById('progression-description').textContent = progression.description_he;
            const shouldHideNames = document.getElementById('toggle-chord-names').checked;

            progression.roots_intervals.forEach((intervalFromRoot, index) => {
                const chordType = progression.chord_types[index];
                const romanSymbol = progression.symbol_roman[index];

                const chordRootDistance = (finalDistance + intervalFromRoot) % 12;
                const chordRootNote = findNoteByDistance(chordRootDistance);
                
                // === ×œ×•×’×™×§×ª MIDI: ×©××™×¨×ª ×”×ª×•×•×™× ×”××¦×•×¤×™× ===
                if (isMidiMode) {
                    // ×—×™×©×•×‘ ×ª×•×•×™ ×”××§×•×¨×“ ×›×¨×©×™××ª ××¡×¤×¨×™× (0-11)
                    // × ×—×©×‘ ×™×“× ×™×ª ××ª ×”-distances ×›××• ×‘×ª×•×š getChordNotes:
                    const expectedNotes = chordType.intervals.map(interval => (chordRootDistance + interval) % 12);
                    currentProgressionTargets.push(expectedNotes);
                }
                // ==========================================

                let chordRootNameEn = chordRootNote.name_en_primary;
                if (selectedAccidental === 'flat' && chordRootNote.name_en_alternate !== chordRootNote.name_en_primary) {
                    chordRootNameEn = chordRootNote.name_en_alternate;
                } else if (selectedAccidental === 'sharp' && chordRootNote.name_en_primary.includes('â™­')) {
                    chordRootNameEn = chordRootNote.name_en_primary;
                }
                
                const chordName = chordRootNameEn + chordType.symbol_suffix;

                const stepEl = document.createElement('div');
                stepEl.className = 'progression-step';
                
                // === ×¡×™××•×Ÿ ×”××§×•×¨×“ ×”×¨××©×•×Ÿ ×›×¤×¢×™×œ ×× ×‘××¦×‘ MIDI ===
                if (isMidiMode && index === 0) {
                    stepEl.classList.add('current-target');
                }
                // ===============================================

                stepEl.onclick = () => openChordModal(chordRootNote, chordType, romanSymbol, chordName);

                const chordNameHTML = shouldHideNames ? '' : `<div class="chord-name">${chordName}</div>`;

                stepEl.innerHTML = `
                    <div class="roman-numeral">${romanSymbol}</div>
                    ${chordNameHTML}
                `;
                container.appendChild(stepEl);
            });
        }
    }


    function openChordModal(rootNote, chordType, romanSymbol, fullChordName) {
        // ××—×©×‘ ××ª ×ª×•×•×™ ×”××§×•×¨×“
        const notes = getChordNotes(rootNote, chordType);
        
        document.getElementById('modal-chord-title').textContent = `${fullChordName} (${romanSymbol}) - ××§×•×¨×“ ${chordType.name_he}`;
        document.getElementById('modal-description').textContent = chordType.description_he;
        
        const notesDisplay = document.getElementById('modal-notes-display');
        notesDisplay.innerHTML = '';

        // ×”×¦×’×ª ×ª×•×•×™ ×”××§×•×¨×“ (LTR)
        notes.forEach(note => {
            const noteEl = document.createElement('div');
            noteEl.className = 'modal-note';
            noteEl.innerHTML = `
                ${note.name_en}
                <span class="hebrew-name">${note.name_he}</span>
            `;
            notesDisplay.appendChild(noteEl);
        });

        document.getElementById('chord-modal').classList.add('active');
    }

    function closeChordModal() {
        document.getElementById('chord-modal').classList.remove('active');
    }

</script>
</body>
</html>
